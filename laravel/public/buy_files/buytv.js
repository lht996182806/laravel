!function(t){function e(i){if(a[i])return a[i].exports;var r=a[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}([function(t,e,a){t.exports=a(1)},function(t,e){var a={tmpl:function(t,e){var a=document.getElementById(t),i=a.innerHTML,r=doT.template(i);return r(e)},loadjsSync:function(t,e,a){var i,r,n,s=[].indexOf||function(t){for(var e=0,a=this.length;a>e;e++)if(e in this&&this[e]===t)return e;return-1};i=arguments.callee,s.call(i,"queue")<0&&(i.queue={}),r=i.queue,s.call(r,t)>=0&&e&&(r[t]?r[t].push(e):e(a)),r[t]=e?[e]:[],n=document.createElement("script"),n.type="text/javascript",n.onload=n.onreadystatechange=function(){if(!n.readyState||"loaded"===n.readyState||"complete"===n.readyState){for(n.onreadystatechange=n.onload=null;r[t].length;)r[t].shift()(a);return r[t]=null,r}},n.src=t,document.getElementsByTagName("head")[0].appendChild(n)}},i={addContent:function(t){var e="content_tmpl",i=t,r=a.tmpl(e,i);return r}},r={config:function(){var t=this;t.PAGEDATA=window.phoneList,t.GRADEDATA={},t.INITFILTER=!1,t.LEVELARR=[],t.HASHARR=[]},pageInitData:function(){var t=this,e=t.PAGEDATA,a={parent:e,arr:e.children},i=e.fontTitle_level;return t.GRADEDATA[i]=a,a}},n={config:function(){r.config()},init:function(){var t=this;t.ADRURL="undefined"==typeof addressUrl?"//s1.mi.com/open/common/js/address_tv_all.js":addressUrl,t.mitv70addr="//s1.mi.com/open/common/js/address_tv70_all.js",t.STOCKURL=MI.GLOBAL_CONFIG.orderSite+"/api/checkTvStock.php",t.addressList={},t.config(),t.allTvData={},t.tv70Data={},t.addressInit(),t.ADRCHOSE={},t.wareHouse="000",t.hdInfoModeType=""},runAll:function(){var t=this;t.pageInitLoad(),t.clickAvailable(),t.triggerClickByHash(),t.provinceClick(),t.cityClick(),t.districtClick(),t.blockClick()},formatAddrList:function(){var t=this,e=[];for(var a in window.tv_data)if(window.tv_data.hasOwnProperty(a)){var i=window.tv_data[a],r={};r.id=i.id,r.name=i.name,r.child=i.child,e.push(r)}t.addressList.province=e,t.addressList.city={},t.addressList.district={},t.addressList.bigblock={}},addressInit:function(){var t=this,e=function(){"undefined"!=typeof addressName&&(window.tv_data=new Function("return "+addressName)()),t.allTvData=window.tv_data,t.formatAddrList(),t.runAll()};a.loadjsSync(t.ADRURL,e),a.loadjsSync(t.mitv70addr,function(){t.tv70Data=window.tv70_data})},pageInitLoad:function(){var t=r.pageInitData(),e=i.addContent(t);if($(".J_choose_block").append(e),t.arr.length>0){var a=t.arr[0].children;if(a){var n={parent:t.arr[0],arr:a},s=t.arr[0].fontTitle_level;r.GRADEDATA[s]=n;var d=i.addContent(n);$(".J_choose_block").append(d),$(".J_choose_block").find(".step-unit").eq(1).addClass("vague")}}},clickAvailable:function(){var t=this;$(".J_choose_block").on("click",".version",function(){var e=$(this).hasClass("stockout");if(e)return!1;if($(this).parent().parent().parent().hasClass("vague"))return!1;$(".J_choose_block").find(".step-unit").eq(1).removeClass("vague");var a=$(this).attr("data-level");-1===$.inArray(a,r.LEVELARR)&&r.LEVELARR.push(a);var n=r.GRADEDATA[a],s=$(this).attr("data-index");$(this).parent().siblings("li").find(".version").removeClass("active"),$(this).addClass("active");var d=$.inArray(a,r.LEVELARR)+1;if(void 0!==typeof n.arr[s].phone_type_tag){r.HASHARR[d-1]=n.arr[s].phone_type_tag;var o=r.HASHARR.length;o>d&&r.HASHARR.splice(d,o-d),o=r.HASHARR.length;var c=$.inArray("",r.HASHARR);-1!==c&&(o=c);for(var l=[],v=0;o>v;v++)l.push(r.HASHARR[v])}$(".J_choose_block").find(".step-unit").each(function(t){t>=d&&$(this).remove()}),t.removeBtnActive();var h=$(this).attr("data-mitvId");if(h){$.isArray(window._bigTvArr)&&$.inArray(h,window._bigTvArr)>=0?(window.tv_data=t.tv70Data,t.formatAddrList()):(window.tv_data=t.allTvData,t.formatAddrList()),t.CUROBJ=n.arr[s],t.showAddressGrade(n.arr[s]);var f=$(".J_line_address").find("select").eq(3).val();return"bl"!==f&&t.getDataByCity(),!1}var p=n.arr[s].children;if(p){var u={parent:n.arr[s],arr:p},_=n.arr[s].fontTitle_level;r.GRADEDATA[_]=u;var m=i.addContent(u);0!==$(".J_choose_block").find(".step-unit").eq(a).length?($(".J_choose_block").find(".step-unit").eq(a).replaceWith(m),$(".J_choose_block").find(".step-unit").each(function(){v>d&&$(this).remove()})):$(".J_choose_block").append(m)}}),$("#J_buyClassBtn").on("click",function(){var t=$(this).attr("data-gid");MI.addShopCart(t,function(t){1===t.code?location.href=MI.GLOBAL_CONFIG.cartSite+"/cart/":(alert(t.message),location.href=MI.GLOBAL_CONFIG.cartSite+"/cart/")},$(this))}),$("#J_goNext").on("click",function(){location.href=MI.GLOBAL_CONFIG.cartSite+"/cart/"})},getAddressDataByStr:function(t,e){var a=[],i=[],r=[],n=[],s=[],d=[],o=[],c={},l={},v={},h={id:0,name:""},f=0,p=this;if(""!==t){t=new Function("return "+t)();for(var u in t)if(t.hasOwnProperty(u)){var _=t[u];0===f&&(c.id=parseInt(u),c.name=_),1===f&&(l.id=parseInt(u),l.name=_),2===f&&(v.id=parseInt(u),v.name=_),3===f&&(h.id=parseInt(u),h.name=_),f++}}for(var m in e)if(e.hasOwnProperty(m)){var A=e[m],b={};b.id=A.id,b.name=A.name,b.child=A.child,b.id===c.id?(b.flag=!0,s=A.child,p.ADRCHOSE.province=b.id):b.flag=!1,a.push(b)}if(0!==s.length){for(var y in s)if(s.hasOwnProperty(y)){var g=s[y],$={};$.id=g.id,$.name=g.name,$.child=g.child,$.id===l.id?($.flag=!0,d=g.child,p.ADRCHOSE.city=$.id):$.flag=!1,i.push($)}if(0!==d.length){for(var C in d)if(d.hasOwnProperty(C)){var B=d[C],k={};k.id=B.id,k.name=B.name,k.warehouse=B.warehouse,k.child=B.tags,k.id===v.id?(k.flag=!0,p.ADRCHOSE.district=k.id,B.tags&&(o=B.tags)):k.flag=!1,r.push(k)}if(0!==o.length)for(var w in o)if(o.hasOwnProperty(w)){var I=o[w],L={};L.id=I.id,L.name=I.name,L.remark=I.remark,L.flag=L.id===h.id?!0:!1,n.push(L)}}}var J={province:a,city:i,district:r,bigblock:n};return J},provinceClick:function(){var t=this;$("body").on("change",".J_line_address select:eq(0)",function(){var e=$(this).val();t.removeBtnActive(),"bl"===e?t.clearByPro(2):(t.clearByPro(3),t.getCityByPro(e),t.updateAdrByIndex("city"))})},cityClick:function(){var t=this;$("body").on("change",".J_line_address select:eq(1)",function(){var e=$(this).val();t.removeBtnActive(),"bl"===e?t.clearByPro(3):(t.clearByPro(4),t.getDisByCity(e),t.updateAdrByIndex("district"))})},districtClick:function(){var t=this;$("body").on("change",".J_line_address select:eq(2)",function(){var e=$(this).val();t.removeBtnActive(),"bl"===e?t.clearByPro(4):(t.getBlockByDis(e),t.updateAdrByIndex("bigblock"),$.each(t.addressList.district,function(a,i){i.id.toString()===e&&(t.wareHouse=i.warehouse)}))})},blockClick:function(){var t=this;$("body").on("change",".J_line_address select:eq(3)",function(){var e=$(this).val();"bl"!==e&&(t.changeDataByBlock(e),t.getDataByCity(),t.showAddressInfo(e))})},showAddressInfo:function(t){var e,a=this;for(e in a.addressList.bigblock)if(a.addressList.bigblock[e]){var i=a.addressList.bigblock[e];i.id===parseInt(t)&&($(".J_address_descp").show(),$(".J_address_descp").find("span").html(i.remark))}},updateAdrByIndex:function(t){var e="address-tmpl",i={},r=this,n=r.addressList;if($(".J_line_address").find(".selectchose").removeClass("input-error"),"city"===t){i={city:n.city};var s=a.tmpl(e,i);$(".J_line_address").find(".selectchose").eq(1).replaceWith(s)}if("district"===t){i={district:n.district};var d=a.tmpl(e,i);$(".J_line_address").find(".selectchose").eq(2).replaceWith(d)}if("bigblock"===t){i={bigblock:n.bigblock};var o=a.tmpl(e,i);$(".J_line_address").find(".selectchose").eq(3).replaceWith(o)}},getCityByPro:function(t){var e=this,a='{"'+t+'":"bl","bl":"bl","bl":"bl","bl":"bl"}',i=e.getAddressDataByStr(a,window.tv_data);e.addressList=i},getDisByCity:function(t){var e=this,a=e.ADRCHOSE.province,i='{"'+a+'":"bl","'+t+'":"bl","bl":"bl","bl":"bl"}',r=e.getAddressDataByStr(i,window.tv_data);e.addressList=r},getBlockByDis:function(t){var e=this,a=e.ADRCHOSE.province,i=e.ADRCHOSE.city,r='{"'+a+'":"bl","'+i+'":"bl","'+t+'":"bl","bl":"bl"}',n=e.getAddressDataByStr(r,window.tv_data);e.addressList=n},changeDataByBlock:function(t){var e=this,a=e.ADRCHOSE.province,i=e.ADRCHOSE.city,r=e.ADRCHOSE.district,n='{"'+a+'":"bl","'+i+'":"bl","'+r+'":"bl","'+t+'":"bl"}',s=e.getAddressDataByStr(n,window.tv_data);e.addressList=s},getDataByCity:function(){var t=this,e=$(".J_line_address").find("select").eq(1).val(),a=t.CUROBJ.mitvId,i="",r=$.inArray(a,MI.GLOBAL_CONFIG.damiaoGoodsId)>=0?!0:!1;r?(i=MI.GLOBAL_CONFIG.damiaoSite+"hdinfo/cn",$.ajax({url:i,dataType:"jsonp",jsonp:"jsonpcallback",jsonpCallback:"hdinfo",data:{storage:t.wareHouse},timeout:1e4,error:function(){t.removeBtnActive()},success:function(e){if(e&&e.status){var i=null,r=e.status.hasOwnProperty(a);if(r&&(i=e.status[a]),t.hdInfoModeType=e.dbe5a2,!i)return void t.removeBtnActive();i.hdstart&&!i.hdstop?t.activeBtn():t.removeBtnActive()}else t.removeBtnActive()}})):(i=t.STOCKURL+"?cityId="+e+"&productId="+a,$.getJSON(i+"&jsonpcallback=?",function(e){$(".J_adrError").hide(),$(".J_adrPresale").hide(),$(".J_btn_next").html("下一步"),0===e.code?(t.activeBtn(),$(".J_tipInfo").html("下一步："+t.CUROBJ.tipInfo)):1===e.code?($(".J_adrError").find("a").attr("href","//order.mi.com/misc/subscribe/goods/"+a),$(".J_adrError").show()):2===e.code?($(".J_adrPresale").find("span").html(e.data.pushDate),$(".J_adrPresale").show(),$(".J_btn_next").html("预订"),t.activeBtn("presale"),$(".J_tipInfo").empty()):(t.activeBtn(),$(".J_tipInfo").html("下一步："+t.CUROBJ.tipInfo))}))},clearByPro:function(t){var e="address-tmpl";if(2===t){var i={city:[]},r=a.tmpl(e,i);$(".J_line_address").find(".selectchose").eq(1).replaceWith(r)}if(2===t||3===t){var n={district:[]},s=a.tmpl(e,n);$(".J_line_address").find(".selectchose").eq(2).replaceWith(s)}if(2===t||3===t||4===t){var d={bigblock:[]},o=a.tmpl(e,d);$(".J_line_address").find(".selectchose").eq(3).replaceWith(o)}},showAddressGrade:function(t){var e=this,i="adr_tmpl",r=e.addressList,n=a.tmpl(i,r),s=parseInt(t.fontTitle_num);$(".J_choose_block").append(n),$(".J_adrLevel").html(s)},triggerClickByHash:function(){var t=window.phoneList,e=0,a=location.hash,i=[],r=function(){for(var a=t.children,n=i[e],s=0,d=0;d<a.length;d++){var o=a[d];n===o.phone_type_tag&&(s=d,$(".J_choose_block").find(".step-unit").eq(e).find(".version").eq(d).trigger("click"))}e++,e<i.length&&(t=a[s],setTimeout(r,100))};""!==a&&(a=a.substring(1),i=a.split("-"),setTimeout(r,100))},removeBtnActive:function(){$(".J_btn_next").removeAttr("href").removeClass("btn-primary").addClass("btn-dake").removeAttr("data-gid").attr("data-disabled","true").removeAttr("onclick"),$(".J_tipInfo").empty(),$(".J_adrError").hide()},activeBtn:function(t){var e=this,a=e.CUROBJ.mitvId;t&&"presale"===t?$(".J_btn_next").removeClass("btn-dake").addClass("btn-primary").removeAttr("data-disabled").attr("href","//cart.mi.com/static/yushou/goodsid/"+a):($(".J_btn_next").removeClass("btn-dake").addClass("btn-primary").removeAttr("data-disabled").attr("data-gid",a),MI.bigtapAddCart({obj:".J_btn_next",storage:e.wareHouse,modeType:e.hdInfoModeType,callback:function(t){if(1===t.code){var e=$(".J_btn_next").attr("data-gid");$("#buy3DClass").length>0&&"2142000012"===e?$("#buy3DClass").modal("show"):location.href=MI.GLOBAL_CONFIG.staticSite+"/buySuccess/?gid="+e}else alert(t.msg)},overCallback:function(){e.removeBtnActive()}}))}};$(function(){var t="mitv";"undefined"!=typeof phoneType&&(t=phoneType),$.ajax({url:MI.GLOBAL_CONFIG.orderSite+"/api/hdstock.php?id=versiondata&type="+t,dataType:"jsonp",jsonp:"jsonpcallback",error:function(){n.init()},success:function(t){phoneList=t,n.init()}})})}]);
OO(["com.mi.utils.time","com.mi.utils.Cookie","com.mi.widgets.sms","com.mi.passport.mibao","com.mi.utils.L11N","com.mi.utils.URL","com.mi.utils.Tip"],"com.mi.passport.portal.2014",function(r,m,i,w,p,j,x,k){window._tickRequests=[];function d(C,E){E=E||"0";var D=(+new Date)+"";var B="/pass/ajax/tick?_t="+D+"&biz="+C+"&step="+E;var z=_tickRequests.length;var A=_tickRequests[z]=new Image;A.onload=A.onerror=function(){A=_tickRequests[z]=null};A.src=B}function v(){location.reload(true)}function s(){location.reload(true)}function y(){var z=m.get("userId");if(z&&!isNaN(z)){if(z!==$(".na-num").text()){s();return false}return true}else{v();return false}}var b="";function l(z){b=z;location.hash=z}function e(z){if(z==="+86"){return"^1\\d{10}$"}else{return"^\\+?\\d{6,}$"}}$.parseJSONSafe=function(z){try{return $.parseJSON(z)}catch(A){return{code:5000000,result:5000000,description:"Not JSON"}}};$.fn.showError=function(z){if(!z){z=""}else{z=""+z}return this.each(function(B,D){var A=$(D);if(A.hasClass("quota_tip")){return}var E=A.attr("_text");if(E&&z){var C=z.charAt(0);if(C==="5"){A.text(E+"("+z+")").show()}else{A.text(E).show()}}else{if(z&&!E){A.text(z).show()}else{A.text(E).show()}}})};$.fn.hideError=function(){return this.each(function(A,B){var z=$(B);if(z.hasClass("quota_tip")){return}var C=z.attr("_text");if(C){z.text(C).hide()}else{z.hide()}})};$.fn.showPopup=function(){this.each(function(B,C){var A=$(C),z=A.closest(".popup_mask");if(z.length){z.show()}A.show();switch(C.id){case"popManageTokenStatus":case"popManageTokenKeys":A.positionPopup();default:}switch(C.id){case"popManageTokenStatus":case"popManageTokenHome":l("#service=setToken");break;case"popSwitchRegion":l("#service=switchRegion");break;case"popUpdatePassword":l("#service=setPassword");break;case"popEnterNewEmail":l("#service=bindEmail");break;case"popEnterNewPhone":l("#service=bindPhone");break;case"popSetMibao":case"popAnswerMibao":case"popFinishMibao":l("#service=setMibao");break;case"popSuicideWarning":l("#service=suicide");break;default:}});if($(".popup_mask:visible").length){$(document.body).css({"overflow-y":"hidden"})}else{}return this};$.fn.hidePopup=function(z){z=z||{};this.each(function(C,D){var B=$(D),A=B.closest(".popup_mask");if(A.length){A.hide()}B.hide();if(!z.dontAffectHash){switch(D.id){case"popUpdatePassword":case"popEnterNewEmail":case"popEnterNewPhone":case"popSetMibao":case"popAnswerMibao":case"popFinishMibao":case"popManageTokenStatus":case"popManageTokenHome":case"popSuicideWarning":case"popSuicidePrompt":case"popSuicideSuccess":case"popSuicideFailure":case"popSwitchRegion":if(location.hash){l("#")}break;default:}}});if($(".popup_mask:visible").length){$(document.body).css({"overflow-y":"hidden"})}else{$(document.body).css({"overflow-y":"scroll"})}return this};$.fn.positionPopup=function(){return this.each(function(B,C){var A=$(C);var z=$(window).height();var D=C.offsetHeight;if(D>z){A.css("top","0")}else{A.css("top",Math.round((z-D)/2)+"px")}})};$.fn.radioTab=function(){var D=function(R){R.__initedTab=true;var L=$(R);var F=L.find(".md_list_con");var M=L.find(".retrieve-type-year");var K=L.find(".retrieve-type-month");var G=L.find(".retrieve-type-date");var Q=new Date();var P=Q.getFullYear();var O=Q.getMonth()+1;var N="";var H="";var J={};J[28]="";for(var I=P;I>2010;I--){N+="<p data-value='"+I+"'>"+I+"</p>"}$.each(["01","02","03","04","05","06","07","08","09","10","11","12"],function(S,T){H+="<p data-value='"+T+"'>"+T+"</p>"});$.each(["13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28"],function(S,T){J[28]+="<p data-value='"+T+"'>"+T+"</p>"});J[28]=H+J[28];J[29]=J[28]+"<p data-value='29'>29</p>";J[30]=J[29]+"<p data-value='30'>30</p>";J[31]=J[30]+"<p data-value='31'>31</p>";M.html(N);K.html(H);L.find(".date-select").each(function(T,U){var V=$(U).find(".date-select-val");var S=$(U).find(".date-select-options");V.click(function(){S.toggle();return false});V.find(".timecon").data("value","");S.delegate("p","click",function(Y){var X=$(this).data("value");var W=V.find(".timecon");if(!W.data("origin")){W.data("origin",W.text())}W.data("value",X).text(X);S.hide();z();C(G,J);return false})});L.find("textarea").bind("input change propertychange",function(){z()})};var E=this;var C=function(G,J){var L=E.filter(".now");var F=L.find(".md_list_con");var N=F.data("type");var I=F.find(".date-select-val .timecon");if(I.length===3){var O=parseInt($(I[0]).data("value"));var H=parseInt($(I[1]).data("value"));var M=parseInt($(I[2]).data("value"));if(O&&H){var K=new Date(new Date(O,H)-1).getDate();G.html(J[K]);if(M&&M>K){var P=$(I[2]).data("origin");P&&$(I[2]).text(P)}}else{var P=$(I[2]).data("origin");P&&$(I[2]).text(P)}}};var A=function(){var J=E.filter(".now");var F=J.find(".md_list_con");var I=F.data("type");var K=J.data("type");var H="";if(I==="date"){var G=F.find(".date-select-val .timecon");H=""+$(G[0]).data("value")+"-"+$(G[1]).data("value")+(G[2]?("-"+$(G[2]).data("value")):"");if(H.split("-").join("").length<6){return false}}else{H=F.find("textarea").val()+"";if(H.length<10){return false}}return{retrieveType:K,retrieveTypeValue:H}};var B="";var z=function(){var F=A();if(F!==B){B=F;E.filter(".now").trigger("radioTabValueChange",F)}};this.each(function(F,G){$(G).click(function(){E.removeClass("now");$(this).addClass("now");$(this).find(".date-select-options").hide();!this.__initedTab&&D(this);z()})});$(this.get(0)).trigger("click");return this};$(function(){$(".err_tip, .txt_tip").each(function(A,B){var z=$(B);z.attr("_text",z.text())})});function q(z){if(z){if(z.code&&z.code!=3001){var A=$("#popVeriFailed");A.find(".err_code").text(z.code);A.showPopup()}}}var g=k.$class({constructor:function(){this.$passwordMgr=$("[_role=passwordMgr]");this.$emailMgr=$("[_role=emailMgr]");this.$phoneMgr=$("[_role=phoneMgr]");this.$mibaoMgr=$("[_role=mibaoMgr]");this.$tokenMgr=$("[_role=tokenMgr]")},syncHash:function(){var A=j.parse(location.hash);var B=location.hash;if(B===b){return}var z=A.service||"";b=B;switch(z){case"bindPhone":d("changePhone");$("#btnUpdatePhone").click();break;case"bindEmail":d("changeEmail");$("#btnUpdateEmail").click();break;case"setMibao":$("#btnSetMibao").click();break;case"setPassword":d("changePassword");$("#btnUpdatePassword").click();break;case"setToken":d("enableTwoStepLogin");$("#btnManageToken").click();break;case"suicide":d("delAccount");this.suicide();break;default:$("#popUpdatePassword, #popEnterNewEmail, #popEnterNewPhone, #popSetMibao, #popAnswerMibao, #popFinishMibao, #popManageTokenStatus, #popSuicideWarning, #popManageTokenHome, #popManageTokenStatus").hidePopup()}},render:function(){this.uiBind();this.syncHash();setInterval(k.proxy(function(){this.syncHash()},this),500)},phoneImageBlurTimer:null,emailImageBlurTimer:null,showPhonePanel:function(){var F=$("#phonePanel");var E=$(".phone-panel-main").show();var D=$(".phone-panel-del").hide();var z=$(".phone-panel-del-success").hide();var A=F.find(".phone_panel_list_con");var B=F.find(".btn_mod_close");F.showPopup();if(!F.data("panel-inited")){F.data("panel-inited",true);A.delegate(".phone_panel_list_el","click",function(G){G.stopPropagation();A.find(".phone_panel_list_el").removeClass("now");$(this).addClass("now")});E.find("a[data-action]").bind("click",k.proxy(function(L){L.stopPropagation();var K=$(L.target).data("action");var J=A.find(".now .phone-panel-number");var H=J.data("phone");var I=J.data("key");if(!H||!I){return}if(K==="update"){d("changePhone");F.hidePopup({dontAffectHash:true});MiAccountVerification({url:"/pass/auth/security/bindSafeAddress?type=PH&userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:k.proxy(function(O){F.hidePopup();this.enterNewPhone(O)},this,{action:K,phone:H,key:I}),fail:function(O){q(O)}})}else{E.hide();D.show();D.find(".err_tip").hide();var N=D.find(".phone-panel-del-title");var M=$(".del-ph-num");N.html(N.data("title-tpl").replace("{phone}",H));M.html(H);var G=H.split(/\*+/);if(G.length===2){D.find(".phone-blank-prefix").text(G[0]+"");D.find(".phone-blank-suffix").text(G[1]+"")}}return false},this));D.find("input[name=delphone]").bind("focus",function(){D.find(".err_tip").hide()});D.find("a[data-action]").bind("click",k.proxy(function(I){I.stopPropagation();var H=$(I.target).data("action");if(H==="cancel"){D.hide();E.show();return}var G=[$.trim(D.find(".phone-blank-prefix").text()),$.trim(D.find("input[name=delphone]").val()),$.trim(D.find(".phone-blank-suffix").text())].join("");var J=D.find(".err_tip");$.ajax({type:"post",url:"/pass/auth/security/deletePhone",dataType:"text",data:{passport_ph:m.get("passport_ph")||"",usercenter_ph:m.get("usercenter_ph")||"",userId:$(".na-num").text(),phone:G},success:function(L){L=L.replace("&&&START&&&","");L=$.parseJSONSafe(L);var K=+L.result;if(K===0){D.hide();z.show()}else{if(K===1200254||K===1200255){J.show().find(".del-error").html(p.getResource("jsp_ph_delete_error"))}else{if(K===5200253||K===5200257){J.show().find(".del-error").html(p.getResource("jsp_error")+K)}}}},fail:function(){J.show().find(".del-error").html(p.getResource("jsp_error"))},error:function(){J.show().find(".del-error").html(p.getResource("jsp_error"))}})},this));z.find("a[data-action]").bind("click",function(G){G.stopPropagation();z.hide();location.reload()});B.bind("click",function(G){G.stopPropagation();location.reload()})}var C=[];$.each(userPhoneList,function(G,H){C.push("<li class='phone_panel_list_el'>  <i class='acctip_icon acctip_icon_8'></i>  <span data-phone='"+H.address+"' class='phone-panel-number' data-key='"+H.key+"'>"+H.address+"</span></li>")});A.html(C.join(""))},suicide:function(){var z=$("#popSuicideWarning");z.find(".twostep_trustinfo").removeClass("now");z.find(".err_tip").hideError();z.showPopup();$.ajax({type:"GET",url:"/pass/auth/security/getAccountStatus",data:{userId:$(".na-num").text()},dataType:"text",success:function(D){D=D.replace("&&&START&&&","");D=$.parseJSONSafe(D);var B=+D.result;if(B===0){var A=+D.info.leftTimes;if(A<=1){z.find(".warn-text").show()}}else{if(B===5200600){var C=D.info&&D.info.sids;$.each((C||[]),function(E,F){z.find(".del-account-deny-"+(F+"").split(".").join("")).show()});z.find(".del-account-allow").hide();z.find(".del-account-deny").show();z.find(".del-account-deny .btn_back").css({border:"1px solid #ff6f3d",color:"#FFF",background:"#ff6f3d"})}else{z.find(".sys_err").showError(B)}}}})},uiBind:function(){$("#popSuicideWarning .twostep_trustinfo").click(function(P){var Q=$("#popSuicideWarning");var R=$(P.currentTarget);R.toggleClass("now");if(Q.find(".sys_err:visible").length){Q.find(".btn_commom").addClass("disabled")}else{if(R.hasClass("now")){Q.find(".btn_commom").removeClass("disabled")}else{Q.find(".btn_commom").addClass("disabled")}}});$("#popSuicideWarning .btn_commom").click(k.proxy(function(Q){Q.preventDefault();var R=$(Q.currentTarget);if(R.hasClass("disabled")){return}$("#popSuicideWarning").hidePopup({dontAffectHash:true});var P=false;MiAccountVerification({url:"/pass/auth/security/del?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:k.proxy(function(){P=true;$("#popSuicideWarning").hidePopup({dontAffectHash:true});$("#popSuicidePrompt").showPopup()},this),fail:function(S){if(P){return}$("#popSuicideWarning").showPopup();q(S)}})},this));$("#popSuicidePrompt .btn_commom").click(function(P){P.preventDefault();var Q=$("#popSuicidePrompt");$.ajax({type:"POST",url:"/pass/auth/security/del",data:{passport_ph:m.get("passport_ph")||"",usercenter_ph:m.get("usercenter_ph")||"",passportsecurity_ph:m.get("passportsecurity_ph")||"",passToken:m.get("passToken")||"",userId:$(".na-num").text()},dataType:"text",success:function(S){S=S.replace("&&&START&&&","");S=$.parseJSONSafe(S);var R=+S.result;if(R===0){$("#popSuicidePrompt").hidePopup({dontAffectHash:true});$("#popSuicideSuccess").showPopup();var T=new r.Countdown({duration:10000,onProgress:function(U){$("#popSuicideSuccess .wapbox p span").text(Math.round(U.timeLeft/1000))},onComplete:function(){location.href="/"}});T.start()}else{switch(R){case 1200603:case 5200604:case 5200605:Q.find(".sys_err").showError(R);default:}}}})});$("#popSuicideWarning .btn_back, #popSuicidePrompt .btn_back, #popSuicideSuccess .btn_back, #popSuicideFailure .btn_back").click(function(P){P.preventDefault();$(P.target).closest(".mod_acc_tip").hidePopup()});$(document.body).delegate(".mod_acc_tip .btn_mod_close, .mod_acc_tip .btn_close_popup","click",function(P){P.preventDefault();var Q=$(P.target).closest(".mod_acc_tip"),R=Q.attr("id");switch(R){case"popManageTokenSetMobile":$("#popManageTokenStatus").showPopup().find(".err_tip").hide();Q.hidePopup();break;case"popManageTokenKeys":$("#popManageTokenStatus").showPopup().find(".err_tip").hide();Q.hidePopup();break;case"popManageTokenDisableFinish":location.href="/";break;case"popManageTokenFinish":location.href="/";break;case"popEnterNewPhone":if(Q.find("dl.success:visible").length){location.href="/"}else{Q.hidePopup()}break;case"popEnterNewEmail":if(Q.find("dl.success:visible").length){location.href="/"}else{Q.hidePopup()}break;case"popSetMibao":location.href="/";break;default:Q.hidePopup()}});$("#popManageTokenTrustDevice .token_chk_area").click(function(R,Q){R.preventDefault();var P=$("#popManageTokenTrustDevice .icon_token_chk");if(JSP_VAR.deviceType==="mobile"){if(P.closest("#popManageTokenTrustDevice").length){R.stopPropagation()}}if(P.hasClass("icon_false")){P.removeClass("icon_false").addClass("icon_true")}else{P.removeClass("icon_true").addClass("icon_false")}});$(".click-row .font-img-item").click(function(Q){Q.preventDefault();Q.stopPropagation();if(JSP_VAR.deviceType!=="mobile"){return}var P=$(Q.currentTarget).parent().find(".ada-btn-area");var R=P.children().length;if(R>1){P.toggle()}else{P.click()}});$("#btnUpdatePassword").click(k.proxy(function(P){P.stopPropagation();P.preventDefault();if(!y()){return}d("changePassword");MiAccountVerification({url:"/pass/auth/security/changePassword?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:k.proxy(function(){this.resetUpdatePasswordForm();this.editPassword()},this),fail:function(Q){q(Q)}})},this));$("#popUpdatePassword .oldPass").on("focus click",k.proxy(function(P){$("#popUpdatePassword .grpOldPass .err_tip").hideError();$("#popUpdatePassword .grpOldPass label").removeClass("error_bg")},this)).blur(k.proxy(function(P){this.checkOldPassword()},this));var A,O;$("#popUpdatePassword .newPass, #popUpdatePassword .newPass2").on("focus click",k.proxy(function(P){P.stopImmediatePropagation();$("#popUpdatePassword .grpNewPass .err_tip").hideError();$("#popUpdatePassword .grpNewPass .txt_tip").show();$("#popUpdatePassword .grpNewPass label").removeClass("error_bg");clearTimeout(A);clearTimeout(O)},this)).blur(k.proxy(function(Q){var R;var P=$(Q.target);if(P.hasClass("newPass")){A=setTimeout(k.proxy(function(){this.checkNewPasswords(Q)},this),300)}else{if(P.hasClass("newPass2")){O=setTimeout(k.proxy(function(){this.checkNewPasswords(Q)},this),300)}}},this));var J=false;$("#popUpdatePassword .chkcode_img, #popUpdatePassword .next_capt").click(k.proxy(function(P){P.preventDefault();this.nextUpdatePasswordCaptcha()},this)).mouseover(k.proxy(function(P){J=true},this)).mouseout(k.proxy(function(P){J=false},this));var L=k.proxy(function(Q){Q.stopImmediatePropagation();var P=Q.target;$(P.parentNode).removeClass("error_bg");$("#popUpdatePassword .capt_box .err_tip").hideError()},this);$("#popUpdatePassword .chkcode input").on("focus click",L).blur(k.proxy(function(P){if(J){return}this.checkPasswordCaptcha()},this));$("#popUpdatePassword .btnCancel").click(k.proxy(function(P){P.preventDefault();$("#popUpdatePassword").hidePopup()},this));$("#popUpdatePassword .btnOK").click(k.proxy(function(P){P.preventDefault();$("#popUpdatePassword .err_tip").hideError();$("#popUpdatePassword .error_bg").removeClass("error_bg");this.onUpdatePassword(P)},this));if(userPhoneList.length){$(".btnBindMobile").text(p.getResource("jsp_add"))}if(userPhoneList.length>1){var H=$(".phone-list-sum");H.html(H.data("title").replace("{phsum}",userPhoneList.length));H.show()}$("#btnUpdatePhone").click(k.proxy(function(S){S.stopPropagation();S.preventDefault();if(!y()){return}var R=S.target;var Q="add";var P=userPhoneList[0]||{};if($(R).data("mode")==="update"){Q="update";if(userPhoneList.length>1){this.showPhonePanel();return}}d("changePhone");MiAccountVerification({url:"/pass/auth/security/bindSafeAddress?type=PH&userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:k.proxy(function(T){this.enterNewPhone(T)},this,{action:Q,phone:P.address,key:P.key}),fail:function(T){q(T)}})},this));$("#popEnterNewPhone .new_capt").click(k.proxy(this.reloadUpdatePhoneCaptcha,this));$("#popEnterNewPhone .chkcode_img").click(k.proxy(this.reloadUpdatePhoneCaptcha,this));$("#popEnterNewPhone .new_phone").on("focus click",function(){var P=$("#popEnterNewPhone");var Q=P.find(".binding");Q.find(".err_tip:not(.empty_capt):not(.wng_capt)").hideError();Q.find(".new_phone").parent().removeClass("error_bg")}).blur(k.proxy(function(S){var Q=$.trim(S.target.value);if(!Q){var P=$("#popEnterNewPhone");var R=P.find(".binding");R.find(".err_tip:not(.empty_capt):not(.wng_capt)").hideError();R.find(".empty_phone").showError();$(S.target).parent().addClass("error_bg")}},this));$("#popEnterNewPhone .capt_box").on("focus click",k.proxy(function(R){clearTimeout(this.phoneImageBlurTimer);var P=$("#popEnterNewPhone");var Q=P.find(".binding");Q.find(".empty_capt, .wng_capt").hideError();Q.find(".capt_box").parent().removeClass("error_bg")},this)).blur(k.proxy(function(S){var P=$("#popEnterNewPhone");var R=P.find(".binding");var Q=$.trim(S.target.value);if(!Q){this.phoneImageBlurTimer=setTimeout(function(){R.find(".err_tip.empty_capt, .err_tip.wng_capt").hideError();R.find(".empty_capt").showError();$(S.target).parent().addClass("error_bg")},200)}},this));$("#popEnterNewPhone .binding .btn_commom").click(k.proxy(this.onEnterNewPhone,this));$("#popEnterNewPhone .binding .set_qst_tit").click(function(P){$("#popEnterNewPhone .binding .set_qst_list").toggle();P.stopPropagation();P.preventDefault()});$("#popEnterNewPhone .binding .set_qst_list").delegate("p","click",function(T){var P=$(T.target),R=P.closest(".set_qst_list").find("p"),S=P.closest("dd").find(".set_qst_tit"),U=S.find("span"),Q=S.find("em");R.removeClass("chk");P.addClass("chk");U.text(P.text());Q.text(P.attr("_code"));P.closest(".set_qst_list").hide();T.preventDefault()});$("#popEnterNewPhone .binding .set_qst_list").delegate("h6","click",function(P){P.stopPropagation()});$("#popEnterNewPhone .btn-cancel, #popManageTokenSetMobile .btn-cancel").bind("click",function(P){P.stopPropagation();$(this).closest(".country-container").hide()});$(document.body).click(function(){$("#popEnterNewPhone .binding .set_qst_list, #popManageTokenSetMobile .binding .set_qst_list").hide()});$("#popEnterNewPhone .binding .set_qst_list, #popManageTokenSetMobile .binding .set_qst_list").bind("click",function(P){P.stopPropagation()});$("#popEnterNewPhone .verify .btn_commom").click(k.proxy(this.onVerifyNewPhone,this));$("#popEnterNewPhone .verify .btn_back, #popEnterNewPhone .btn_mod_close").click(k.proxy(this.cancelUpdatePhone,this));$("#popEnterNewPhone .success .btn_commom").click(function(P){location.href="/"});var F=null;$("#popEnterNewPhone .verify .phone_capt").on("focus click",k.proxy(function(P){clearInterval(F);$("#popEnterNewPhone .verify .err_tip:not(.quota_tip)").hideError();$("#popEnterNewPhone .verify .phone_capt").parent().removeClass("error_bg")},this)).blur(k.proxy(function(Q){var P=Q.target;if(!$.trim(P.value)){F=setTimeout(function(){$("#popEnterNewPhone .verify .empty_capt").showError();$("#popEnterNewPhone .verify .phone_capt").parent().addClass("error_bg")},200)}},this));$("#popEnterNewPhone .verify .resend").click(function(){clearTimeout(F)});var I=i.Sender;if(this.updatePhoneSMSSender){this.updatePhoneSMSSender.stop()}var G=this.updatePhoneSMSSender=new I({smsFailureMsgBox:".sms_custom",maxQuotaToShow:2,timeStep:60*1000,type:150007,userBox:$('<input type="text">').val($(".na-num").text()),phoneBox:"#popEnterNewPhone .binding .full_new_phone",icodeCallback:function(Q,U){var T=p.getResource("jsp_regst_img_code_incorrect");var R=$("#popEnterNewPhone");var S=R.find(".binding");var P=R.find(".verify");S.find(".chkcode_img").click();S.find(".capt_box").val("");if(Q===0){$(R.find(".tab_opt span").removeClass("now")[1]).addClass("now");$(R.find(".tabline i").removeClass("now")[1]).addClass("now");S.hide();P.show()}else{if(Q===1200201){S.find(".wng_capt").showError(T);S.find(".capt_box").parent().addClass("error_bg")}else{if(Q===1200258){S.find(".wng_fmt").showError(Q);S.find(".new_phone").parent().addClass("error_bg")}else{if(Q===1200259){S.find(".phone_bound").showError(Q);S.find(".new_phone").parent().addClass("error_bg")}else{if(Q===1200260){S.find(".phone_bound_elsewhere").showError(Q);S.find(".new_phone").parent().addClass("error_bg")}else{if(Q===1200210){S.find(".reach_max").showError(Q);S.find(".new_phone").parent().addClass("error_bg")}else{S.find(".sys_err").showError(Q)}}}}}}},getCaptchaPostData:function(Q){var P=$("#popEnterNewPhone .new_phone").val();var S=$("#popEnterNewPhone .set_qst_list p.chk").attr("_code")||"";var T=$("#popEnterNewPhone .binding .capt_box").val();if(S==="+86"){S=""}P=S+P;var R={addressType:"PH",replace:!!userPhoneList.length,userId:$(".na-num").text(),passport_ph:m.get("passport_ph")||"",usercenter_ph:m.get("usercenter_ph")||"",passportsecurity_ph:m.get("passportsecurity_ph")||"",passToken:m.get("passToken")||"",newAddress:P,contentType:150007};!Q&&(R.icode=T);return R},phoneTipLabel:"",duplicatePhoneHTML:"",sendButton:"#popEnterNewPhone .verify .resend",captchaBox:"#popEnterNewPhone .verify .phone_capt","403Label":".fbdn_tip",quotaTextLabel:"#quotaTextLabel",quotaLabel:"#quotaLabel",captchaURL:"/pass/auth/security/sendSafeAddressTicket",quotaURL:"/pass/sms/quota",captchaVerifyLabel:"",captchaVerifyURL:"",checkBindingURL:""});G.render();$("#popEnterNewPhone .binding .btn_commom").click(function(P){P.preventDefault()});$("#btnUpdateEmail").click(k.proxy(function(P){P.stopPropagation();P.preventDefault();if(!y()){return}d("changeEmail");MiAccountVerification({url:"/pass/auth/security/bindSafeAddress?type=EM&userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:k.proxy(function(){this.enterNewEmail()},this),fail:function(Q){q(Q)}})},this));$("#popEnterNewEmail .binding .new_email").on("focus click",function(P){$("#popEnterNewEmail .binding .err_tip:not(.empty_capt):not(.wng_capt)").hideError();$("#popEnterNewEmail .binding .new_email").parent().removeClass("error_bg")}).blur(k.proxy(function(S){var P=$("#popEnterNewEmail");var R=P.find(".binding");var Q=$.trim(S.target.value);if(!Q){R.find(".err_tip:not(.empty_capt):not(.wng_capt)").hideError();R.find(".empty_email").showError();$(S.target).parent().addClass("error_bg")}},this));$("#popEnterNewEmail .binding .capt_box").on("focus click",k.proxy(function(R){clearTimeout(this.emailImageBlurTimer);var P=$("#popEnterNewEmail");var Q=P.find(".binding");Q.find(".err_tip.empty_capt, .err_tip.wng_capt").hideError();Q.find(".capt_box").parent().removeClass("error_bg")},this)).blur(k.proxy(function(R){var P=$("#popEnterNewEmail");var Q=P.find(".binding");if(!$.trim(R.target.value)){this.emailImageBlurTimer=setTimeout(function(){Q.find(".err_tip.empty_capt, .err_tip.wng_capt").hideError();Q.find(".empty_capt").showError();Q.find(".capt_box").parent().addClass("error_bg")},200)}},this));$("#popEnterNewEmail .binding .chkcode_img, #popEnterNewEmail .binding .chkcode_img + a").click(k.proxy(function(Q){Q.preventDefault();clearTimeout(this.emailImageBlurTimer);var P=$("#popEnterNewEmail .binding .chkcode_img");P.attr("src",P.attr("_src")+"&_="+r.now())},this));$("#popEnterNewEmail .binding .btn_commom").click(k.proxy(this.onEnterNewEmail,this));var K=$("#popEnterNewEmail .binding .select-edm");K.click(k.proxy(function(P){if(K.hasClass("now")){K.removeClass("now")}else{K.addClass("now")}},this)).trigger("click");$("#popEnterNewEmail .verify .resend").click(k.proxy(this.onResendNewEmail,this));$("#popEnterNewEmail .verify .capt_box").on("focus click",k.proxy(function(R){clearTimeout(this.emailCaptBlurTimer);var Q=$("#popEnterNewEmail");var P=Q.find(".verify");P.find(".err_tip").hideError();$("#popEnterNewEmail .verify .capt_box").parent().removeClass("error_bg")},this)).blur(k.proxy(function(R){var Q=$("#popEnterNewEmail");var P=Q.find(".verify");if(!$.trim(R.target.value)){this.emailCaptBlurTimer=setTimeout(function(){P.find(".empty_capt").showError();P.find(".capt_box").parent().addClass("error_bg")},200)}},this));$("#popEnterNewEmail .verify .btn_back, #popEnterNewEmail .btn_mod_close").click(k.proxy(this.cancelUpdateEmail,this));$("#popEnterNewEmail .verify .btn_commom").click(k.proxy(this.onVerifyNewEmail,this));$("#popEnterNewEmail .success .btn_commom").click(function(Q){Q.preventDefault();var P=$("#popEnterNewEmail");location.href="/"});var E=false;$("#btnSetMibao").click(k.proxy(function(P){P.stopPropagation();P.preventDefault();if(!y()){return}d("changeMibao");MiAccountVerification({url:"/pass/auth/security/setSafeQuestions?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:k.proxy(function(){if(!E){if(D){C.render();E=true;$("#popSetMibao form").bind("submit",z)}else{if(!y()){return}$.ajax({type:"GET",url:"/pass/auth/security/verifyQuestions",dataType:"text",data:{userId:$(".na-num").text(),_:+new Date},error:v,success:function(Q){Q=Q.replace("&&&START&&&","");Q=$.parseJSONSafe(Q);if(Q.result===0){window.mibaoData=window.pageData=Q.info}C.render();E=true;$("#popSetMibao form").bind("submit",z)}})}}this.setMibao()},this),fail:function(Q){q(Q)}})},this));var M=$("#frmSetQuestions");var D=window.mibaoData||window.pageData;var C;C=this.setMibaoForm=new w.QuestionForm({form:M,ajax:true});var z=k.proxy(function(R){var S=$("#popAnswerMibao");var Q=$("#popSetMibao select.iselect");var P=S.find(".set_mibao li p");P.each(function(U,V){var T=$(V);T.text(Q[U].value)});$("#popSetMibao").hidePopup();this.answerMibao()},this);$("#popAnswerMibao .input_bg input").bind("focus",function(P){$(P.target).closest("li").find(".error-mes").hide()});$("#popAnswerMibao .btn_back").click(function(P){P.preventDefault();$("#popAnswerMibao").hidePopup();$("#popSetMibao").showPopup();$("#popAnswerMibao .input_bg input").val("");return false});$("#popAnswerMibao .btn_commom").click(function(R){R.preventDefault();var P=$("#popAnswerMibao .form-error-mes");P.hide();var Q=false;$("#popAnswerMibao .input_bg input").each(function(U,V){var T=$(V);var S=T.closest("li").find(".error-mes");var W=T.val();if(!W){S.text(p.getResource("answer_empty")).show();Q=true}else{S.text("").hide()}});if(Q){return}if(!y()){return}$.ajax({url:"/pass/auth/security/setSafeQuestions",type:"POST",data:{userId:$(".na-num").text(),passport_ph:m.get("passport_ph")||"",usercenter_ph:m.get("usercenter_ph")||"",passportsecurity_ph:m.get("passportsecurity_ph")||"",passToken:m.get("passToken")||"",questions:$("#popSetMibao .form-data").val(),verifiedQuestions:(function(){var S=[];$("#popAnswerMibao .input_bg input").each(k.proxy(function(U,V){var T=$(V);$question=T.parent().parent().find("p");S.push('{"q":"'+w.QuestionForm.addSlashes($question.html())+'","a":"'+w.QuestionForm.addSlashes(T.val())+'"}')},this));return"["+S.join(",")+"]"})()},dataType:"text",error:v,success:function(S){S=S.replace("&&&START&&&","");S=$.parseJSONSafe(S);if(S.result===0){P.hide();$("#popAnswerMibao").hidePopup();$("#popFinishMibao").showPopup();d("changeMibao","end")}else{switch(S.result){case 1200305:P.text(p.getResource("wrong_answer")).show();break;case 5200306:case 5200307:case 5200308:P.text(p.getResource("jsp_2014_tip23")+"("+S.result+")").show();break;default:}}}});return false});$("#popFinishMibao .btn_commom").click(function(P){P.preventDefault();location.href="/"});$("#btnManageToken").click(k.proxy(function(P){P.stopPropagation();P.preventDefault();if(!y()){return}d("enableTwoStepLogin");this.manageToken()},this));$(document.body).delegate("a[_href]","click",k.proxy(function(T){T.preventDefault();var S=$(T.target);var V=$(S.attr("_href"));var R=S.attr("_target")||"self";var U=S.parents(".mod_acc_tip",true);var Q=U.attr("id");var W=V.attr("id");function P(){V.find(".disten30x76 img").removeAttr("src").removeAttr("_secret").removeAttr("_reset");V.find("input[type=text]").val("");V.find(".err_tip").hideError();if(!y()){return}$.ajax({type:"get",url:"/pass/auth/security/genEnableSecret",data:{userId:$(".na-num").text(),reset:$("#btnManageToken a").attr("__href").indexOf("status")>-1},dataType:"text",error:v,success:function(X){X=X.replace("&&&START&&&","");X=$.parseJSONSafe(X);if(X.result===0){V.find(".disten30x76 img").attr("src",X.info.QRCodeUrl).attr("_secret",X.info.secret).removeAttr("_reset");if(U.attr("id")==="popManageTokenStatus"){V.find(".disten30x76 img").attr("_reset",true)}V.find(".err_tip").hideError();if(R!=="_blank"){U.hidePopup({dontAffectHash:true})}V.showPopup()}else{U.find(".sys_err").showError(X.result)}}})}switch(W){case"popManageTokenDownload":if($("#btnManageToken a").attr("__href").indexOf("status")>-1){$("#popManageTokenDownload .tip_btns").addClass("token_enabled")}else{$("#popManageTokenDownload .tip_btns").removeClass("token_enabled")}if(R!=="_blank"){U.hidePopup({dontAffectHash:true})}V.showPopup();break;case"popManageTokenSetMobile":if(!y()){return}MiAccountVerification({url:"/pass/auth/security/setBackupPhone?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:k.proxy(function(){if(R!=="_blank"){U.hidePopup()}V.hideError().showPopup();V.find(".error_bg").removeClass("error_bg");V.find(".err_tip").hideError()},this),fail:function(X){q(X)}});break;case"popManageTokenActivate":if(Q==="popManageTokenStatus"){if(!y()){return}MiAccountVerification({url:"/pass/auth/security/enableTwoStepLogin?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:k.proxy(function(){P()},this),fail:function(X){q(X)}})}else{P()}break;case"popManageTokenKeys":V.find(".mi_code span").remove();if(!y()){return}$.ajax({url:"/pass/auth/security/backupOtp",dataType:"text",type:"GET",data:{userId:$(".na-num").text(),_:+new Date},error:v,success:function(Z){Z=Z.replace("&&&START&&&","");Z=$.parseJSONSafe(Z);if(Z.result===0){var Y=Z.info.codes;var X=V.find(".mi_code");$.each(Y,function(aa,ab){if($.trim(ab)){X.append("<span>"+ab+"</span>")}else{X.append("<span _used>"+p.getResource("jsp_2014_token_used")+"</span>")}});if(Z.info.email){V.find(".sendEmail").attr("href","mailto:"+Z.info.email)}if(R!=="_blank"){U.hidePopup()}V.showPopup()}}});break;case"popEnterNewEmail":if(!y()){return}MiAccountVerification({url:"/pass/auth/security/bindSafeAddress?type=email&userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:k.proxy(function(){if(R!=="_blank"){U.hidePopup()}this.enterNewEmail()},this),fail:function(X){q(X)}});break;case"popEnterNewPhone":if(!y()){return}MiAccountVerification({url:"/pass/auth/security/bindSafeAddress?type=phone&userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:k.proxy(function(){if(R!=="_blank"){U.hidePopup()}this.enterNewPhone()},this),fail:function(X){q(X)}});break;case"popManageTokenDownAct":if($("#btnUpdateEmail a").attr("__href").indexOf("replace=true")===-1){if(R!=="_blank"){U.hidePopup()}$("#popManageTokenBindEmail").showPopup();return}if(!userPhoneList.length){if(R!=="_blank"){U.hidePopup()}$("#popManageTokenBindPhone").showPopup();return}if(R!=="_blank"){U.hidePopup()}if(!y()){return}MiAccountVerification({url:"/pass/auth/security/enableTwoStepLogin?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:k.proxy(function(){V.find(".err_tip").hideError();V.showPopup()},this),fail:function(X){q(X)}});break;default:V.find(".err_tip").hideError();if(R!=="_blank"){U.hidePopup()}V.showPopup()}},this));$("#popManageTokenDownload .newtab a").click(function(R){R.preventDefault();$("#popManageTokenDownload .newtab a").removeClass("now");var Q=$(R.target);Q.addClass("now");var P=Q.index();$($("#popManageTokenDownload .tabcon").hide()[P]).show()});$("#popManageTokenActivate input[type=text]").on("focus click",function(P){$("#popManageTokenActivate .err_tip").hideError();$("#popManageTokenActivate .input_bg").removeClass("error_bg")}).blur(function(P){if(!$.trim(P.target.value)){$("#popManageTokenActivate .empty_capt").showError();$("#popManageTokenActivate .input_bg").addClass("error_bg")}});$("#popManageTokenActivate .btn_commom").click(function(Q){Q.preventDefault();$("#popManageTokenActivate .err_tip").hideError();$("#popManageTokenActivate .input_bg").removeClass("error_bg");var P=$.trim($("#popManageTokenActivate input[type=text]").val());if(!P){$("#popManageTokenActivate .empty_capt").showError();$("#popManageTokenActivate .input_bg").addClass("error_bg");return}if(!y()){return}$.ajax({dataType:"text",url:"/pass/auth/security/checkCode",type:"POST",data:{passport_ph:m.get("passport_ph")||"",usercenter_ph:m.get("usercenter_ph")||"",passportsecurity_ph:m.get("passportsecurity_ph")||"",passToken:m.get("passToken")||"",userId:$(".na-num").text(),secret:$("#popManageTokenActivate .disten30x76 img").attr("_secret"),code:P},error:v,success:function(R){R=R.replace("&&&START&&&","");R=$.parseJSONSafe(R);if(R.result===0){if(!y()){return}MiAccountVerification({url:"/pass/auth/security/enableTwoStepLogin?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:function(){$("#popManageTokenActivate").hidePopup();$("#popManageTokenTrustDevice .mod_trust i").addClass("icon_true");$("#popManageTokenTrustDevice").showPopup()},fail:function(S){q(S)}})}else{$("#popManageTokenActivate .err_tip").hideError();$("#popManageTokenActivate .input_bg").addClass("error_bg");switch(R.result){case 1200413:case 1200414:$("#popManageTokenActivate .wng_capt").showError(R.result);break;case 5200415:case 5000000:$("#popManageTokenActivate .sys_err").showError(R.result);break;default:}}}})});$("#popManageTokenTrustDevice .btn_commom").click(function(P){P.preventDefault();if(!y()){return}$.ajax({url:"/pass/auth/security/enableTwoStepLogin",type:"post",dataType:"text",data:{passport_ph:m.get("passport_ph")||"",usercenter_ph:m.get("usercenter_ph")||"",passportsecurity_ph:m.get("passportsecurity_ph")||"",passToken:m.get("passToken")||"",userId:$(".na-num").text(),secret:$("#popManageTokenActivate .disten30x76 img").attr("_secret"),reset:!!$("#popManageTokenActivate .disten30x76 img").attr("_reset"),isTrustEnable:!!$("#popManageTokenTrustDevice .mod_trust .icon_true").length,code:$("#popManageTokenActivate input[type=text]").val()},error:v,success:function(Q){Q=Q.replace("&&&START&&&","");Q=$.parseJSONSafe(Q);if(Q.result===0){$("#popManageTokenTrustDevice").hidePopup();var R=new r.Countdown({duration:10000,onProgress:function(S){$("#popManageTokenFinish .logoutCountdown").text(Math.round(S.timeLeft/1000))},onComplete:function(){location.href="/"}});R.start();$("#popManageTokenFinish .err_tip").hideError();$("#popManageTokenFinish").showPopup();d("enableTwoStepLogin","end")}else{switch(Q.result){case 5200430:$("#popManageTokenTrustDevice .wng_capt").showError(Q.result);break;default:$("#popManageTokenTrustDevice .sys_err").showError(Q.result)}}}})});$("#popManageTokenStatus .tip_btns .btn_disable_token").click(function(P){P.preventDefault();$("#popManageTokenStatus").hidePopup();if(!y()){return}MiAccountVerification({url:"/pass/auth/security/disableTwoStepLogin?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:k.proxy(function(){$("#popManageTokenStatus .sys_err").hideError();if(!y()){return}$.ajax({url:"/pass/auth/security/disableTwoStepLogin",type:"POST",dataType:"text",data:{passport_ph:m.get("passport_ph")||"",usercenter_ph:m.get("usercenter_ph")||"",passportsecurity_ph:m.get("passportsecurity_ph")||"",passToken:m.get("passToken")||"",userId:$(".na-num").text()},error:v,success:function(Q){Q=Q.replace("&&&START&&&","");Q=$.parseJSONSafe(Q);$("#popManageTokenStatus").showPopup();if(Q.result===0){$("#popManageTokenStatus").hidePopup();$("#popManageTokenDisableFinish").showPopup()}else{switch(Q.result){case 5200433:case 5200434:case 5200456:case 5200457:case 5200458:case 5000000:$("#popManageTokenStatus .sys_err").showError(Q.result);break;default:}}}})},this),fail:function(Q){$("#popManageTokenStatus").showPopup();q(Q)}})});$("#popManageTokenKeys #refresh_code").click(function(Q){Q.preventDefault();var P=$("#popManageTokenKeys .mi_code");if(!y()){return}$.ajax({type:"POST",url:"/pass/auth/security/refreshBackupOtp",dataType:"text",data:{passport_ph:m.get("passport_ph")||"",usercenter_ph:m.get("usercenter_ph")||"",passportsecurity_ph:m.get("passportsecurity_ph")||"",passToken:m.get("passToken")||"",userId:$(".na-num").text()},error:v,success:function(S){S=S.replace("&&&START&&&","");S=$.parseJSONSafe(S);if(S.result===0){P.find("span").remove();var R=S.info.codes;$.each(R,function(T,U){if($.trim(U)){P.append("<span>"+U+"</span>")}else{P.append("<span _used>"+p.getResource("jsp_2014_token_used")+"</span>")}})}}})});$("#popManageTokenSetMobile .set_qst_tit").click(function(P){$("#popManageTokenSetMobile .set_qst_list").toggle();P.stopPropagation();P.preventDefault()});$("#popManageTokenSetMobile .set_qst_list").delegate("p","click",function(T){var P=$(T.target),R=P.closest(".set_qst_list").find("p"),S=P.closest(".fixpos").find(".set_qst_tit"),U=S.find("span"),Q=S.find("em");R.removeClass("chk");P.addClass("chk");U.text(P.text());Q.text(P.attr("_code"));P.closest(".set_qst_list").hide();T.preventDefault()});$("#popManageTokenSetMobile .set_qst_list").delegate("h6","click",function(P){P.stopPropagation()});$("#popManageTokenSetMobile .backupPhoneInput").on("focus click",function(P){$("#popManageTokenSetMobile .err_tip").hideError();$("#popManageTokenSetMobile .input_bg").removeClass("error_bg")});$("#popManageTokenSetMobile .btn_commom").click(k.proxy(function(S){S.preventDefault();var T=$("#popManageTokenSetMobile"),U=T.find(".backupPhoneInput");var P=U.val();if(!P){T.find(".empty_phone").showError();$("#popManageTokenSetMobile .input_bg").addClass("error_bg");return}if(!/^\d+$/.test(P)){T.find(".wng_fmt").showError();$("#popManageTokenSetMobile .input_bg").addClass("error_bg");return}var R=$.trim(T.find(".c_b em").text());if(R==="+86"){R=""}var Q=R+P;if(!y()){return}$.ajax({type:"POST",dataType:"text",url:"/pass/auth/security/setBackupPhone",data:{passport_ph:m.get("passport_ph")||"",usercenter_ph:m.get("usercenter_ph")||"",passportsecurity_ph:m.get("passportsecurity_ph")||"",passToken:m.get("passToken")||"",userId:$(".na-num").text(),phone:Q,replace:$("#popManageTokenStatus li:first-child dd").hasClass(".has_fb_mobile")},error:v,success:k.proxy(function(V){V=V.replace("&&&START&&&","");V=$.parseJSONSafe(V);T.find(".err_tip").hideError();T.find(".backupPhoneInput").val("");if(V.result===0){$("#popManageTokenStatus li:first-child dd .fb_mobile span").text(Q);$("#popManageTokenStatus li:first-child dd").addClass("has_fb_mobile");T.hideError();T.hidePopup();this.manageToken()}else{$("#popManageTokenSetMobile .input_bg").addClass("error_bg");switch(V.result){case 1200444:$("#popManageTokenSetMobile .empty_phone").showError(V.result);break;case 1200445:$("#popManageTokenSetMobile .wng_fmt").showError(V.result);break;case 1200446:$("#popManageTokenSetMobile .bad_param").showError(V.result);break;case 1200448:$("#popManageTokenSetMobile .dupl_phone").showError(V.result);break;case 1200449:$("#popManageTokenSetMobile .set_fail").showError(V.result);break;case 5200451:case 5200450:case 5200447:case 5000000:$("#popManageTokenSetMobile .sys_err").showError(V.result);break;default:$("#popManageTokenSetMobile .set_fail").showError(V.result)}}},this)})},this));$("#popManageTokenStatus .delBackupPhone").click(function(P){P.preventDefault();if(!y()){return}MiAccountVerification({url:"/pass/auth/security/deleteBackupPhone?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:k.proxy(function(){$("#popManageTokenStatus .sys_err").hideError();if(!y()){return}$.ajax({url:"/pass/auth/security/deleteBackupPhone",dataType:"text",type:"POST",data:{passport_ph:m.get("passport_ph")||"",usercenter_ph:m.get("usercenter_ph")||"",passportsecurity_ph:m.get("passportsecurity_ph")||"",passToken:m.get("passToken")||"",userId:$(".na-num").text()},error:v,success:function(Q){Q=Q.replace("&&&START&&&","");Q=$.parseJSONSafe(Q);if(Q.result===0){$("#popManageTokenStatus li:first-child dd .fb_mobile span").text("");$("#popManageTokenStatus li:first-child dd").removeClass("has_fb_mobile")}else{switch(Q.result){case 5200452:case 5200453:case 5200455:case 5000000:$("#popManageTokenStatus .sys_err").showError(Q.result);break;case 1200454:$("#popManageTokenStatus .backup_phone_not_exists").showError(Q.result);break;default:}}}})},this),fail:function(Q){q(Q)}})});$("#popManageTokenKeys .sendEmail").click(function(R){var Q=[];$("#popManageTokenKeys .mi_code span:not([_used])").each(function(T,U){Q.push($.trim($(U).text()))});var S="?subject="+encodeURIComponent(p.getResource("jsp_2014_my_backup_keys"))+"&body="+Q.join(" \r\n");var P=R.target.href;if(P.indexOf("subject=")===-1){P+=S}else{P=P.replace(/\?.*$/g,S)}R.target.href=P});$("#popUpdatePassword .oldPass, #popUpdatePassword .newPass, #popUpdatePassword .newPass2, #popUpdatePassword .capt_box").keypress(function(P){if(P.keyCode===13){P.preventDefault();$("#popUpdatePassword .btnOK").click()}});$("#popEnterNewEmail .binding .new_email, #popEnterNewEmail .binding .capt_box").keypress(function(P){if(P.keyCode===13){P.preventDefault();$("#popEnterNewEmail .binding .btn_commom").click()}});$("#popEnterNewEmail .verify .capt_box").keypress(function(P){if(P.keyCode===13){P.preventDefault();$("#popEnterNewEmail .verify .btn_commom").click()}});$("#popEnterNewPhone .binding .new_phone, #popEnterNewPhone .binding .capt_box").keypress(function(P){if(P.keyCode===13){P.preventDefault();$("#popEnterNewPhone .binding .btn_commom").click()}});$("#popEnterNewPhone .verify .phone_capt").keypress(function(P){if(P.keyCode===13){P.preventDefault();$("#popEnterNewPhone .verify .btn_commom").click()}});$("#printKeys").click(function(P){P.preventDefault();window.print()});var N=$("#popManageTokenStatus");var B=$("#popManageTokenKeys");$(window).resize(r.debounce(function(){N.positionPopup();B.positionPopup()}));$("#popVeriFailed .btn_back").click(function(Q){Q.preventDefault();var P=$(Q.target);var R=P.closest(".mod_acc_tip");R.hidePopup()})},resetUpdatePasswordForm:function(z){z=z||{};var A=$("#popUpdatePassword");A.find(".error_bg").removeClass("error_bg");A.find(".grpOldPass .err_tip, .capt_box .err_tip").hideError();if(!z.keepInputs){A.find("input[type=text], input[type=password]").val("")}},nextUpdatePasswordCaptcha:function(B){var A=$("#popUpdatePassword .chkcode_img");var z=A.attr("src")||"/pass/getCode?icodeType=login&_t=0";z=z.replace(/_t\=\d*/g,"_t="+(+new Date));A.attr("src",z)},onUpdatePasswordSuccess:function(){$("#popUpdatePassword").hidePopup();$("#popUpdatePasswordSuccess").showPopup();var z=new r.Countdown({duration:10000,onProgress:function(A){$("#popUpdatePasswordSuccess .logoutCountdown").text(Math.round(A.timeLeft/1000))},onComplete:function(){location.href="/"}});z.start();d("changePassword","end")},onOldPasswordWrong:function(z){$("#popUpdatePassword .grpOldPass .wng_pwd").showError(z);$("#popUpdatePassword .oldPass").parent().addClass("error_bg");$("#popUpdatePassword .capt_box .chkcode input").val("")},onUpdatePasswordCaptchaWrong:function(z){$("#popUpdatePassword .capt_box .wng_capt").showError(z);$("#popUpdatePassword .capt_box .chkcode").addClass("error_bg");$("#popUpdatePassword .capt_box .chkcode input").val("");$("#popUpdatePassword .grpOldPass label").removeClass("error_bg");$("#popUpdatePassword .grpOldPass .wng_pwd").hideError()},updatePasswordAttempts:0,MAX_UPDATE_CAPTLESS_ATTEMPTS:3,onUpdatePasswordSystemError:function(z){$("#popUpdatePassword .sys_err").showError(z)},onUpdatePasswordTooMuchError:function(z){$("#popUpdatePassword .too_much").showError(z)},onUpdatePasswordEmailDisallowedError:function(z){$("#popUpdatePassword .eq_email").showError(z)},pwdInBlackList:function(z){$("#popUpdatePassword .pwd_in_black").showError(z)},repwdFormatError:function(z){$("#popUpdatePassword .repwd_format_error").showError(z);$("#popUpdatePassword .newPass").parent().addClass("error_bg")},onUpdatePassword:function(z){if(!this.checkOldPassword()||!this.checkNewPasswords(z)){return false}var A=$("#popUpdatePassword");if(A.find(".oldPass").val()===A.find(".newPass").val()){A.find(".same_pwd").showError();A.find(".grpNewPass label").addClass("error_bg");return false}if($("#popUpdatePassword .capt_box").css("display")!=="none"){if(!this.checkPasswordCaptcha()){return false}}this.resetUpdatePasswordForm({keepInputs:true});if(!y()){return}$.ajax({url:"/pass/auth/security/changePassword",type:"POST",dataType:"text",data:{passport_ph:m.get("passport_ph")||"",usercenter_ph:m.get("usercenter_ph")||"",passportsecurity_ph:m.get("passportsecurity_ph")||"",passToken:m.get("passToken")||"",userId:$(".na-num").text(),oldPassword:$("#popUpdatePassword .oldPass").val(),password:$("#popUpdatePassword .newPass").val(),icode:$.trim($("#popUpdatePassword .chkcode input").val())},error:v,success:k.proxy(function(C){C=C.replace("&&&START&&&","");C=$.parseJSONSafe(C);var B=C.result;if(B===0){this.onUpdatePasswordSuccess()}else{switch(B){case 110021001:case 110041001:case 1200106:this.onOldPasswordWrong(C.result);break;case 1200102:this.repwdFormatError(C.result);break;case 1200107:case 1200105:this.onUpdatePasswordCaptchaWrong(C.result);break;case 550065002:case 550001008:case 550025000:case 550065000:case 5200107:case 5200108:case 5200109:case 5200111:case 5000000:this.onUpdatePasswordSystemError(C.result);break;case 4200104:this.onUpdatePasswordTooMuchError(C.result);break;case 1200110:this.onUpdatePasswordEmailDisallowedError(C.result);break;case 4200112:this.pwdInBlackList(C.result);break;default:}if(C.info&&C.info.captchaUrl){this.requirePasswordCaptcha(C.info.captchaUrl)}}},this)});return true},checkOldPassword:function(){var z=$("#popUpdatePassword .oldPass").val();if(!z){$("#popUpdatePassword .grpOldPass .empty_pwd").showError();$("#popUpdatePassword .grpOldPass label").addClass("error_bg")}else{$("#popUpdatePassword .grpOldPass .empty_pwd").hideError();$("#popUpdatePassword .grpOldPass label").removeClass("error_bg")}return !!z},checkNewPasswords:function(F){var E=$("#popUpdatePassword .newPass").val(),z=$("#popUpdatePassword .newPass2").val();if(!E){if(!$(F.target).hasClass(".newPass")){$("#popUpdatePassword .grpNewPass .empty_pwd").showError();$("#popUpdatePassword .newPass").parent().addClass("error_bg")}return false}else{$("#popUpdatePassword .grpNewPass .empty_pwd").hideError();$("#popUpdatePassword .newPass").parent().removeClass("error_bg")}if(!z){$("#popUpdatePassword .grpNewPass .empty_pwd2").showError();$("#popUpdatePassword .newPass2").parent().addClass("error_bg");return false}else{$("#popUpdatePassword .grpNewPass .empty_pwd2").hideError();$("#popUpdatePassword .newPass2").parent().removeClass("error_bg")}if(E!==z){$("#popUpdatePassword .grpNewPass .pwd_mismatch").showError();$("#popUpdatePassword .newPass2").parent().addClass("error_bg");return false}else{$("#popUpdatePassword .grpNewPass .pwd_mismatch").hideError();$("#popUpdatePassword .newPass2").parent().removeClass("error_bg")}var B=/\d/g,A=/[a-zA-Z]/g,D=/[^0-9a-zA-Z]/g;var C=0+B.test(E)+A.test(E)+D.test(E);if(C<2||E.length<8||E.length>16){$("#popUpdatePassword .grpNewPass .pwd_fmt").showError();$("#popUpdatePassword .grpNewPass .txt_tip").hide();$("#popUpdatePassword .newPass").parent().addClass("error_bg");$("#popUpdatePassword .newPass2").parent().addClass("error_bg");return false}else{$("#popUpdatePassword .grpNewPass .pwd_fmt").hideError();$("#popUpdatePassword .grpNewPass .txt_tip").show();$("#popUpdatePassword .newPass").parent().removeClass("error_bg");$("#popUpdatePassword .newPass2").parent().removeClass("error_bg")}return true},checkPasswordCaptcha:function(){var z=$.trim($("#popUpdatePassword .chkcode input").val());if(!z){$("#popUpdatePassword .capt_box .empty_capt").showError();$("#popUpdatePassword .capt_box .chkcode").addClass("error_bg");return false}else{$("#popUpdatePassword .capt_box .empty_capt").hideError();$("#popUpdatePassword .capt_box .chkcode").removeClass("error_bg")}return true},requirePasswordCaptcha:function(z){z=z||"/pass/getCode?icodeType=login";z+="&_t="+(+new Date);$("#popUpdatePassword .capt_box .chkcode_img").attr("src",z);$("#popUpdatePassword .capt_box").show()},checkNewPhone:k.proxy(function(D){D();return;var A=$("#popEnterNewPhone");var C=A.find(".binding");var z=C.find(".new_phone").val();var B=$("#popEnterNewPhone .set_qst_list p.chk").attr("_code")||"";if(B==="+86"){B=""}z=B+z;if(!$.trim($("#popEnterNewPhone .capt_box").val())){return}if(!y()){return}$.ajax({url:"/pass/auth/security/checkSafeAddressParams",type:"POST",data:{passport_ph:m.get("passport_ph")||"",usercenter_ph:m.get("usercenter_ph")||"",passportsecurity_ph:m.get("passportsecurity_ph")||"",passToken:m.get("passToken")||"",addressType:"PH",userId:$(".na-num").text(),newAddress:z,icode:$.trim(C.find(".capt_box").val()),replace:!!userPhoneList.length},dataType:"text",error:v,success:function(E){E=E.replace("&&&START&&&","");E=$.parseJSONSafe(E);if(E.result===0){if(D){D()}}else{C.find(".chkcode_img").click();C.find(".capt_box").val("");switch(E.result){case 1200216:C.find(".wng_fmt").showError(E.result);C.find(".new_phone").parent().addClass("error_bg");break;case 1200205:C.find(".phone_bound").showError(E.result);C.find(".new_phone").parent().addClass("error_bg");break;case 1200207:C.find(".phone_bound_elsewhere").showError(E.result);C.find(".new_phone").parent().addClass("error_bg");break;case 5200203:case 5200204:case 5200206:case 5200218:case 5000000:C.find(".sys_err").showError(E.result);break;case 1200201:C.find(".wng_capt").showError(E.result);C.find(".capt_box").parent().addClass("error_bg");break;case 1200202:C.find(".bad_param").showError(E.result);break;case 1200217:C.find(".dupl_phone").showError(E.result);C.find(".new_phone").parent().addClass("error_bg");break;default:}}}})},this),checkNewEmail:function(D){var B=this;var z=$("#popEnterNewEmail");var C=z.find(".binding");var A=C.find(".new_email").val();if(!A){C.find(".empty_email").showError();return false}if(!/^[\w.\-]+@(?:[a-z0-9]+(?:-[a-z0-9]+)*\.)+[a-z]{2,6}$/.test(A)){C.find(".wng_fmt").showError();return false}if(!y()){return}D();return;$.ajax({url:"/pass/auth/security/checkSafeAddressParams",type:"POST",data:{passport_ph:m.get("passport_ph")||"",usercenter_ph:m.get("usercenter_ph")||"",passportsecurity_ph:m.get("passportsecurity_ph")||"",passToken:m.get("passToken")||"",addressType:"EM",userId:$(".na-num").text(),newAddress:A,icode:$.trim(C.find(".capt_box").val()),replace:$("#btnUpdateEmail a").attr("__href").indexOf("replace=true")>-1},dataType:"text",error:v,success:k.proxy(function(F){F=F.replace("&&&START&&&","");F=$.parseJSONSafe(F);if(F.result===0){if(D){D()}}else{var E=$("#popEnterNewEmail .binding .chkcode_img");E.attr("src",E.attr("src")+"&_="+r.now());$("#popEnterNewEmail .binding .capt_box").val("").parent().addClass("error_bg");clearTimeout(B.emailImageBlurTimer);switch(F.result){case 1200216:C.find(".wng_fmt").showError(F.result);break;case 1200205:C.find(".email_bound").showError(F.result);break;case 1200207:C.find(".email_bound_elsewhere").showError(F.result);break;case 5200203:case 5200204:case 5200206:case 5000000:C.find(".sys_err").showError(F.result);break;case 1200201:C.find(".wng_capt").showError(F.result);break;case 1200202:C.find(".bad_param").showError(F.result);break;default:}}},this)})},onEnterNewPhone:function(F){var A=$("#popEnterNewPhone");var E=A.find(".binding");E.find(".err_tip").hideError();var z=E.find(".new_phone").val();if(!z){E.find(".empty_phone").showError();E.find(".new_phone").parent().addClass("error_bg");if(F){F.preventDefault()}return false}var D=E.find(".set_qst_tit").find("em").text();var B=e(D);if(!RegExp(B).test(z)){E.find(".wng_fmt").showError();E.find(".new_phone").parent().addClass("error_bg");if(F){F.preventDefault()}return false}var C=$.trim(A.find(".capt_box").val());if(!C){E.find(".empty_capt").showError();A.find(".capt_box").parent().addClass("error_bg");if(F){F.preventDefault()}return false}this.checkNewPhone(k.proxy(function(){var I=$.trim($("#popEnterNewPhone .binding .set_qst_tit em").text());if(I==="+86"){I=""}var H=I;if(!H){H="+86"}var G=A.find(".verify");G.find(".disten30x103 h6 em").text(" "+H+" "+z+" ");G.find(".err_tip").hide();$("#popEnterNewPhone .binding .full_new_phone").val(I+z);var J=this.updatePhoneSMSSender;if(typeof this.updatePhoneSMSSender.quota==="number"){$("#popEnterNewPhone .verify .resend").click()}else{if(!y()){return}$.ajax({url:J.quotaURL,dataType:"text",type:"POST",data:J.getQuotaPostData?J.getQuotaPostData():{address:J.$phoneBox.val(),contentType:J.type,userId:J.type?J.$userBox.val():-1},error:v,success:k.proxy(function(L){L=J.constructor.toJSON(L);var K=+L.info||0;J.quota=K;J.showQuota(J.quota);if(J.quota<=0){if(J.quotaURL){if(J.countdown){J.countdown.stop()}J.disabled=true;J.disableSendButton()}}else{$("#popEnterNewPhone .verify .resend").click()}},J)})}},this));if(F){F.preventDefault()}return false},onVerifyNewEmail:function(E){if(E){E.preventDefault()}var D=this;var A=$("#popEnterNewEmail");var z=A.find(".verify");var C=A.find(".success");var B=$.trim(z.find(".capt_box").val());if(!B){z.find(".empty_capt").showError();z.find(".capt_box").parent().addClass("error_bg");return}if(!y()){return}$.ajax({type:"post",dataType:"text",url:"/pass/auth/security/bindSafeAddress",data:{vkey:$.trim(z.find(".capt_box").val()),userId:$(".na-num").text(),newAddress:$("#popEnterNewEmail .binding .new_email").val(),passport_ph:m.get("passport_ph")||"",usercenter_ph:m.get("usercenter_ph")||"",passportsecurity_ph:m.get("passportsecurity_ph")||"",passToken:m.get("passToken")||"",addressType:"EM",edm:$("#popEnterNewEmail .binding .select-edm").hasClass("now")?"true":"false",replace:$("#btnUpdateEmail a").attr("__href").indexOf("replace=true")>-1},error:v,success:function(F){F=F.replace("&&&START&&&","");F=$.parseJSONSafe(F);if(F.result===0){z.find(".capt_box").parent().removeClass("error_bg");$(A.find(".tab_opt span").removeClass("now")[2]).addClass("now");$(A.find(".tabline i").removeClass("now")[2]).addClass("now");z.hide();C.show();d("changeEmail","end")}else{z.find(".err_tip").hideError();z.find(".capt_box").parent().addClass("error_bg");switch(F.result){case 1200212:z.find(".wng_capt").showError(F.result);break;case 5200213:case 5200214:case 5000000:z.find(".sys_err").showError(F.result);break;default:}}}})},onVerifyNewPhone:function(C){if(C){C.preventDefault()}if(!$.trim($("#popEnterNewPhone .verify .phone_capt").val())){$("#popEnterNewPhone .verify .phone_capt").parent().addClass("error_bg");$("#popEnterNewPhone .verify .empty_capt").showError();return}var A=$("#popEnterNewPhone").data("action")==="update"?"/pass/auth/security/updatePhone":"/pass/auth/security/addPhone";var B=$("#popEnterNewPhone").data("phone");var D=$("#popEnterNewPhone").data("key");if(!y()){return}var z=$.trim($("#popEnterNewPhone .binding .full_new_phone").val());$.ajax({type:"POST",dataType:"text",url:A,data:{userId:$(".na-num").text(),vkey:$.trim($("#popEnterNewPhone .verify .phone_capt").val()),passport_ph:m.get("passport_ph")||"",usercenter_ph:m.get("usercenter_ph")||"",passportsecurity_ph:m.get("passportsecurity_ph")||"",newPhone:z,oldPhoneKey:D,oldPhone:B,phone:z},error:v,success:function(H){H=H.replace("&&&START&&&","");H=$.parseJSONSafe(H);var F=$("#popEnterNewPhone");var E=F.find(".verify");var G=F.find(".success");if(H.result===0){$(F.find(".tab_opt span").removeClass("now")[2]).addClass("now");$(F.find(".tabline i").removeClass("now")[2]).addClass("now");E.hide();G.show();d("changePhone","end")}else{F.find(".verify .err_tip").hideError();$("#popEnterNewPhone .verify .phone_capt").parent().addClass("error_bg");switch(H.result){case 4200219:case 4200243:case 4200250:F.find(".verify .phone_used").showError(H.result);break;case 1200212:case 1200241:case 1200248:F.find(".verify .wng_capt").showError(H.result);break;default:F.find(".verify .sms_custom").showError(""+H.result)}}}});return false},reloadUpdatePhoneCaptcha:function(A){clearTimeout(this.phoneImageBlurTimer);var z=$("#popEnterNewPhone .chkcode_img");var B=z.attr("src");if(B.indexOf("?")===-1){B+="?"}else{B+="&"}B+="_="+(+new Date);z.attr("src",B);if(A){A.preventDefault()}return false},cancelUpdatePhone:function(A){$("#popEnterNewPhone").hidePopup();var z=this.updatePhoneSMSSender;z.countdown&&z.countdown.stop();z.sendTimes=0;if(A){A.preventDefault()}return false},showTip:function(z){},hideTip:function(z){},editPassword:function(){if(!y()){return}$.ajax({url:"/pass/auth/security/changePassword",type:"get",dataType:"text",data:{userId:$(".na-num").text()},error:v,success:k.proxy(function(z){z=z.replace("&&&START&&&","");z=$.parseJSONSafe(z);if(z.result===0){var A=$("#popUpdatePassword");A.showPopup().find(".err_tip").hide();A.find(".grpNewPass .txt_tip").show();if(z.info.captchaUrl){this.requirePasswordCaptcha(z.info.captchaUrl)}else{$("#popUpdatePassword .capt_box").hide()}}},this)})},updatePassword:function(){},editEmail:function(){},updateEmail:function(){},enterNewPhone:function(z){window.console&&window.console.log&&window.console.log(z);var B=$("#popEnterNewPhone");if(z.action){B.data("action",z.action);B.data("phone",z.phone);B.data("key",z.key)}$(B.find(".tab_opt span").removeClass("now")[0]).addClass("now");$(B.find(".tabline i").removeClass("now")[0]).addClass("now");B.find(".binding").show();B.find(".verify").hide();B.find(".success").hide();B.find("input").val("");B.find(".error_bg").removeClass("error_bg");B.find(".err_tip").hideError();var A=B.find(".chkcode_img");A.attr("src",A.attr("_src")+"&_="+r.now());B.showPopup()},enterNewEmail:function(){var A=$("#popEnterNewEmail");$(A.find(".tab_opt span").removeClass("now")[0]).addClass("now");$(A.find(".tabline i").removeClass("now")[0]).addClass("now");A.find(".binding").show();A.find(".verify").hide();A.find(".success").hide();A.find("input").val("");A.find(".error_bg").removeClass("error_bg");A.find(".err_tip").hideError();var z=A.find(".chkcode_img");z.attr("src",z.attr("_src")+"&_="+r.now());A.showPopup()},setMibao:function(){var B=$("#popSetMibao");B.find(".error-mes").html("").hide();var z=$("#frmSetQuestions ul > li");z.each(function(D,E){var C=$(E);var F=C.find('dd[_type^="-"]');if(!F.length){F=C.find("dd.def-opt")}F.click()});$("#frmSetQuestions").trigger("reset");B.showPopup();var A=$("#popAnswerMibao");A.find("li label input").val("");A.find("li > p").html("")},answerMibao:function(A){var B=$("#popAnswerMibao");B.find(".error-mes").text("").hide();if(A&&A.list&&A.list.length){var z=B.find(".set_mibao li p");z.each(function(C,D){$(D).text(A.list[C].q)})}B.showPopup()},manageToken:function(){var B;var z=$("#btnManageToken a");var A=z.attr("__href");if(A.indexOf("status")>-1){B=$("#popManageTokenStatus")}else{if(A.indexOf("explain")>-1){B=$("#popManageTokenHome")}}if(B){if(B.attr("id")==="popManageTokenStatus"){if(!y()){return}$.ajax({url:"/pass/auth/security/twoStepLoginStatus",type:"GET",dataType:"text",data:{userId:$(".na-num").text(),_:+new Date},error:v,success:function(C){C=C.replace("&&&START&&&","");C=$.parseJSONSafe(C);var D=C.info.hasBackupPhone;if(D){B.find("li:first-child dd .fb_mobile span").text(C.info.backupPhone);B.find("li:first-child dd").addClass("has_fb_mobile")}else{B.find("li:first-child dd").removeClass("has_fb_mobile")}B.find(".err_tip").hideError();B.showPopup()}})}else{B.find(".err_tip").hideError();B.showPopup()}}},confirmMibao:function(){var z=$("#popAnswerMibao");z.showPopup()},emailSendTimes:0,emailCaptBlurTimer:null,sendLeftTimes:null,onResendNewEmail:function(G){clearInterval(this.emailCaptBlurTimer);var z=$("#popEnterNewEmail");var H=z.find(".resend");var C=z.find(".verify");var F=z.find(".binding");var I=$("#emailQuotaTextLabel");if(!y()){return}var B={};!this.emailSendTimes&&(B.icode=F.find(".capt_box").val());var A=k.proxy(function(){$.ajax({url:"/pass/sms/quota",dataType:"text",type:"POST",data:{address:z.find(".new_email").val(),contentType:150007,userId:$(".na-num").text()},error:v,success:k.proxy(function(K){K=K.replace("&&&START&&&","");K=$.parseJSONSafe(K);if(K.result==0){var J=+K.info||0;this.sendLeftTimes=J}},this)})},this);var D=k.proxy(function(J){if(J<=2){I.show();var K=I.text().replace("{left}",J);I.text(K)}else{I.hide()}},this);var E=k.proxy(function(){$.ajax({type:"POST",url:"/pass/auth/security/sendSafeAddressTicket",data:$.extend({passport_ph:m.get("passport_ph")||"",usercenter_ph:m.get("usercenter_ph")||"",passportsecurity_ph:m.get("passportsecurity_ph")||"",passToken:m.get("passToken")||"",userId:$(".na-num").text(),newAddress:z.find(".new_email").val(),addressType:"EM",replace:$("#btnUpdateEmail a").attr("__href").indexOf("replace=true")>-1},B),dataType:"text",error:v,success:k.proxy(function(N){N=N.replace("&&&START&&&","");N=$.parseJSONSafe(N);var J=N.result||N.code;if(N.result===0){H.addClass("noSend");var M=60000+60000*this.emailSendTimes++,K=100;var P=new Date;var O=H.attr("title");this.timer=setInterval(k.proxy(function(){var Q=new Date;var S=Q-P;var R=M/1000-Math.round(S/1000);if(R>0){H.text(O+"("+R+")")}else{H.removeClass("noSend").text(O);clearInterval(this.timer)}},this),K);$(z.find(".tab_opt span").removeClass("now")[1]).addClass("now");$(z.find(".tabline i").removeClass("now")[1]).addClass("now");this.sendLeftTimes=Math.max(this.sendLeftTimes-1,0);if(this.sendLeftTimes===0){H.addClass("noSend").text(O);clearInterval(this.timer)}D(this.sendLeftTimes);F.hide();C.show()}else{C.find(".err_tip").hideError();var L=F.find(".chkcode_img");L.attr("src",L.attr("src")+"&_="+r.now());F.find(".capt_box").val("").parent().addClass("error_bg");H.removeClass("noSend").text(O);clearInterval(this.timer);if(J===1200201||J===87001){F.find(".wng_capt").showError(J)}switch(N.result){case 1200216:case 1200258:F.find(".wng_fmt").showError(N.result);break;case 1200205:case 1200259:F.find(".email_bound").showError(N.result);break;case 1200207:case 1200260:F.find(".email_bound_elsewhere").showError(N.result);break;case 5200203:case 5200204:case 5200206:case 5200261:case 5000000:F.find(".sys_err").showError(N.result);break;case 1200201:F.find(".wng_capt").showError(N.result);break;case 1200202:F.find(".bad_param").showError(N.result);break;case 1200210:F.find(".err_tip.reach_max").showError(N.result);break;default:}switch(N.result){case 5200209:case 5000000:C.find(".err_tip.sys_err").showError(N.result);break;default:}}},this)})},this);if(!this.initQuota){this.initQuota=1;A()}if(!H.hasClass("noSend")){H.addClass("noSend");E()}},cancelUpdateEmail:function(B){B.preventDefault();var z=$("#popEnterNewEmail");z.hidePopup();var A=z.find(".resend");var C=A.attr("title");A.removeClass("noSend").text(C);this.emailSendTimes=0;clearInterval(this.timer)},onEnterNewEmail:function(D){var z=$("#popEnterNewEmail");var C=z.find(".binding");C.find(".err_tip").hideError();var A=C.find(".new_email").val();if(!A){C.find(".empty_email").showError();C.find(".new_email").parent().addClass("error_bg");if(D){D.preventDefault()}return false}if(!/^[\w.\-]+@(?:[a-z0-9]+(?:-[a-z0-9]+)*\.)+[a-z]{2,6}$/.test(A)){C.find(".wng_fmt").showError();C.find(".new_email").parent().addClass("error_bg");if(D){D.preventDefault()}return false}var B=$.trim(z.find(".capt_box").val());if(!B){C.find(".empty_capt").showError();z.find(".capt_box").parent().addClass("error_bg");if(D){D.preventDefault()}return false}this.checkNewEmail(function(){var E=z.find(".verify");E.find(".disten30x103 h6 em").text(" "+A+" ");$("#popEnterNewEmail .verify .resend").click()});if(D){D.preventDefault()}return false},updatePhone:function(){},editMibaoQuestions:function(){},updateMibaoQuestions:function(){},enableToken:function(){},disableToken:function(){}});var u=k.$class({constructor:function(z){z=z||{};profilesgp=z.sgp},syncHash:function(){var A=j.parse(location.hash);var B=location.hash;if(B===b){return}var z=A.service||"";b=B;switch(z){case"switchRegion":d("switchRegion");$("#switchRegion").click();break;default:$("#popSwitchRegion").hidePopup()}},uploadingPhoto:false,render:function(){$(document.body).delegate(".mod_acc_tip .btn_mod_close, .btn_back","click",k.proxy(function(al){al.preventDefault();var aj=$(al.target),an=al.target.id,am=aj.closest(".mod_acc_tip"),ak=am.attr("id");switch(an){case"reuploadPhoto":$("#photoUploader")[0].reset();$($(".layeruploadface .mod_tip_bd").hide()[0]).showPopup();$(".uploadimgs img").removeAttr("style").removeAttr("src");break;case"abortUpload":this.uploadingPhoto=false;$(al.target).closest(".mod_acc_tip").hidePopup();$(".naImgLink a").click();$("#uploadPhoto").attr("src","about:blank");$(".uploadimgs img").removeAttr("style").removeAttr("src");break;default:$(al.target).closest(".mod_acc_tip").hidePopup()}},this));$(".main_l").click(function(aj){aj.preventDefault();aj.stopPropagation();if(JSP_VAR.deviceType!=="mobile"){return}$(aj.currentTarget).find(".naImgLink a").click()});var z=2013;var Q='<div class="select_panel select-year-panel">';for(var ae=z;ae>=1900;ae--){Q+='<p value="'+ae+'">'+ae+"</p>"}Q+="</div>";$(".select-year").prepend(Q);var ad=$(".select-year-panel");var C=new Date().getFullYear();var N="";if(ad.length&&C>z){for(var ae=C;ae>z;ae--){N+='<p value="'+ae+'">'+ae+"</p>"}ad.prepend(N)}$(".birth-box .btn-cancel").bind("click",function(aj){aj.stopPropagation();$(this).closest(".tits_list").hide()});$(".titsbirth").bind("click",function(aj){aj.stopPropagation();$(aj.target).closest("li").find(".tits_list").toggle()});$(document.body).click(function(aj){$(".tits_list").hide()});$(".birth-box").delegate(".tits_list","click",function(aj){aj.stopPropagation()});$(".birth-box").delegate(".tits_list p","click",function(am){var aj=$(am.target);var ak=aj.closest("li");var al=aj.attr("value");if(ak.hasClass("biry")){S(al)}else{if(ak.hasClass("birm")){ah(al)}else{M(al)}}aj.closest(".tits_list").hide();$(".layereditinfo ul").trigger("birthChange")});$(".layereditinfo ul").bind("birthChange",function(){$(".layereditinfo .error-birth").hideError()});$(".infosex span").click(function(al){var aj=$(al.target);var ak=aj.closest(".infosex");ak.find("span").removeClass("now");aj.closest("span",true).addClass("now")});function R(aj){if(aj===""){return}$(".infosex span").removeClass("now");if(isNaN(aj)){$(".infosex em:contains("+aj+")").closest("span").addClass("now")}else{$($(".infosex span")[aj]).addClass("now")}}function K(aj){aj=+aj;return(aj%100!==0&&aj%4===0)||(aj%100===0&&aj%400===0)}function ab(al,am,ak){al=parseInt(al,10);am=parseInt(am,10);ak=parseInt(ak,10);var aj=K(al);var an=B.concat([]);if(aj){an[2]=29}if(ak<=an[am]){return true}else{return false}}var B=[0,31,28,31,30,31,30,31,31,30,31,30,31];var Z=new Date,ai=Z.getFullYear(),A=Z.getMonth()+1,X=Z.getDate();function S(al){if(!al){$(".biry .birthcon").text(p.getResource("jsp_birthday_year"));return}$(".biry .birthcon").text(al);if(al==ai){$(".birm .tits_list p").each(function(an,ao){var ap=parseInt(ao.getAttribute("value"),10);if(ap<=A){$(ao).show()}else{$(ao).hide()}})}else{$(".birm .tits_list p").show()}var ak=$(".biry .birthcon").text(),am=$(".birm .birthcon").text(),aj=$(".bird .birthcon").text();if(isNaN(ak)||isNaN(am)||isNaN(aj)){return}if(!ab(ak,am,aj)){$(".bird .birthcon").text(p.getResource("jsp_birthday_date"))}ah(am)}function ah(al){if(!al){$(".birm .birthcon").text(p.getResource("jsp_birthday_month"));return}$(".birm .birthcon").text(al);al=parseInt(al,10);var an=B[al];if(K($(".biry .birthcon").text())&&al===2){an=29}$(".bird .tits_list p").each(function(ao,ap){if(ao<an){$(ap).show()}else{$(ap).hide()}});if($(".biry .birthcon").text()==ai&&parseInt($(".birm .birthcon").text())===A){$(".bird .tits_list p").each(function(ap,aq){var ao=parseInt(aq.getAttribute("value"),10);if(ao<=X){$(aq).show()}else{$(aq).hide()}})}else{}var ak=$(".biry .birthcon").text(),am=$(".birm .birthcon").text(),aj=$(".bird .birthcon").text();if(isNaN(ak)||isNaN(am)||isNaN(aj)){return}if(!ab(ak,am,aj)){$(".bird .birthcon").text(p.getResource("jsp_birthday_date"))}else{M(aj)}}function M(aj){if(!aj){$(".bird .birthcon").text(p.getResource("jsp_birthday_date"));return}$(".bird .birthcon").text(aj)}$("#popSwitchRegion .country-container li").click(function(ak){var an=$(ak.target).closest("li");var am=an.find("span");var aj=$.trim(am.attr("_brief")),al=$.trim(am.text());$("#popSwitchRegion .listtit tt").attr("_code",aj).text(al);an.closest(".country-container").hide()});$("#continueSwitch").click(function(ak){ak.preventDefault();var aj=$("#popSwitchRegion > .mod_tip_bd");$(aj[0]).hide();$(aj[1]).show()});$(document.body).click(function(aj){$("#popSwitchRegion .country-container").hide()});$("#popSwitchRegion .country-container").bind("click",function(aj){aj.stopPropagation()});$("#popSwitchRegion .btn-cancel").bind("click",function(aj){aj.stopPropagation();$(this).closest(".country-container").hide()});$("#popSwitchRegion .listtit").click(function(aj){aj.stopPropagation();$("#popSwitchRegion .country-container").toggle()});$("#doRegionSwitch").click(function(aj){aj.preventDefault();if(!y()){return}$("#popSwitchRegion .err_tip").hideError();if(!$("#popSwitchRegion .listtit tt").attr("_code")){$("#popSwitchRegion .empty_region").showError();return}if(!y()){return}$.ajax({url:"/pass/auth/profile/userRegion",type:"POST",dataType:"text",data:{userId:$(".na-num").text(),region:$("#popSwitchRegion .listtit tt").attr("_code"),passport_ph:m.get("passport_ph")||"",usercenter_ph:m.get("usercenter_ph")||"",passportsecurity_ph:m.get("passportsecurity_ph")||"",passToken:m.get("passToken")||""},error:v,success:function(ak){ak=ak.replace("&&&START&&&","");ak=$.parseJSONSafe(ak);if(ak.result===0){$("#popSwitchRegion").hidePopup();location.reload(true)}else{switch(ak.result){case 5200526:case 5200527:$("#popSwitchRegion .sys_err").showError(ak.result);break;case 1200525:$("#popSwitchRegion .bad_param").showError(ak.result);break;default:$("#popSwitchRegion .sys_err").showError(ak.result)}}}})});$("#switchRegion").click(function(an){an.preventDefault();if(!y()){return}var al=$("#popSwitchRegion > .mod_tip_bd");$("#popSwitchRegion .err_tip").hideError();$(al[0]).show();$(al[1]).hide();var am=$("#region");var aj=am.attr("_code")||"";var ap=$('#popSwitchRegion .country-container li span[_brief="'+aj+'"]');if(ap.length){var ak=$.trim(ap.attr("_brief")),ao=$.trim(ap.text());$("#popSwitchRegion .listtit tt").attr("_code",ak).text(ao)}$("#popSwitchRegion").showPopup()});(function(){var ak=$("#region");var aj=ak.attr("_code")||"";var am=$('#popSwitchRegion .country-container li span[_brief="'+aj+'"]');if(am.length){var al=$.trim(am.text());ak.text(al)}})();$("#editInfo, #editInfoWap").click(function(ap){ap.preventDefault();if(!y()){return}var aj=$(".layereditinfo");aj.find(".err_tip").hideError();var ak=$(".uinfo");var am=$.trim(ak.find(".lblnickname .value").text());if(ak.find(".lblnickname .value").attr("_empty")!==undefined){am=""}$("input[name=nickname]").val(am);var au=$.trim(ak.find(".lblbirthday .value").text());if(ak.find(".lblbirthday .value").attr("_empty")!==undefined){au=""}if(/\d+\/\d+\/\d+/.test(au)){var ar=au.split("/");ar.reverse();au=ar.join("-")}var an=au.split("-"),aq=an[0],ao=an[1],al=an[2];S(aq);ah(ao);M(al);var at=$.trim(ak.find(".lblgender .value").text());if(ak.find(".lblgender .value").attr("_empty")!==undefined){at=""}R(at);aj.showPopup()});$(".layereditinfo .nickname").on("focus click",function(aj){$(".layereditinfo .err_tip").hideError()});function ac(aj){aj=""+aj;if(aj.length===1){aj="0"+aj}return aj}$(".layereditinfo .btn_commom").click(function(aq){aq.preventDefault();if(!y()){return}var aj=$.trim($(".layereditinfo .nickname").val());var ao="";var am=parseInt($(".layereditinfo .biry .birthcon").text(),10),ap=parseInt($(".layereditinfo .birm .birthcon").text(),10),ak=parseInt($(".layereditinfo .bird .birthcon").text(),10);var an;var al=new Date().setFullYear(ai-13);if(!aj){$(".layereditinfo .empty_name").showError();return}if(aj.length<2||aj.length>20){$(".layereditinfo .bad_nickname").showError();return}if(!am||!ap||!ak){ao="";if(profilesgp){$(".layereditinfo .empty_birthday").showError();return}}else{if(al-new Date().setFullYear(am)<0&&profilesgp){$(".layereditinfo .invalid_birthday").showError();return}else{ao=[am,ac(ap),ac(ak)].join("-")}}an=32-(new Date(am,ap-1,32)).getDate();if(ak>an){$(".bird .birthcon").text(p.getResource("jsp_birthday_date"))}if(!y()){return}$.ajax({type:"POST",dataType:"text",url:"/pass/auth/profile/userProfile",data:{nickname:aj,birthday:ao,gender:$(".layereditinfo .infosex .now").attr("value")||"",userId:$(".na-num").text(),passport_ph:m.get("passport_ph")||"",usercenter_ph:m.get("usercenter_ph")||"",passportsecurity_ph:m.get("passportsecurity_ph")||"",passToken:m.get("passToken")||""},error:v,success:function(ar){ar=ar.replace("&&&START&&&","");ar=$.parseJSONSafe(ar);if(ar.result===0){$(".layereditinfo").hidePopup();location.reload(true)}else{$(".layereditinfo .err_tip").hideError();switch(ar.result){case 1200503:$(".layereditinfo .empty_param").showError(ar.result);break;case 1200504:$(".layereditinfo .bad_nickname").showError(ar.result);break;case 1200505:$(".layereditinfo .bad_birthday").showError(ar.result);break;case 1200506:$(".layereditinfo .bad_gender").showError(ar.result);break;case 1200507:$(".layereditinfo .bad_param").showError(ar.result);break;case 1200508:case 5200509:case 5200510:case 5000000:$(".layereditinfo .sys_err").showError(ar.result);break;default:}}}})});$(".uplodefile").change(k.proxy(function(aq){if(!y()){return}var ao=aq.target.files;if(ao&&ao.length){var al=ao[0];if(al.size>1<<21){$(".layeruploadface .file_too_large").showError();return}}var ak=aq.target.value,an=aq.target.form,aj=$(an);$(".layeruploadface").find(".err_tip").hide();if(ak){var ap=ak.lastIndexOf(".");if(ap!==-1){var am=ak.substring(ap+1).toLowerCase();if(am!=="png"&&am!=="jpg"){$(".layeruploadface .wng_fmt").showError();return}}}$(".layeruploadface .err_tip").hideError();this.uploadingPhoto=true;if(!y()){return}$.ajax({type:"POST",url:"/pass/auth/profile/requestUpload",dataType:"text",data:{userId:$(".na-num").text(),passport_ph:m.get("passport_ph")||"",usercenter_ph:m.get("usercenter_ph")||"",passportsecurity_ph:m.get("passportsecurity_ph")||"",passToken:m.get("passToken")||"",quality:"1.0",isRedirect:"true"},error:v,success:k.proxy(function(ar){ar=ar.replace("&&&START&&&","");ar=$.parseJSONSafe(ar);if(ar.result===0){$(".layeruploadface .preupload").hide();$(".layeruploadface .uploading .err_tip").hideError();$(".layeruploadface .uploading").show();var at=ar.info.tempUploadUrl;an.action=at;aj.submit()}else{switch(ar.result){case 5200512:case 5200513:case 5000000:$(".layeruploadface .preupload .sys_err").showError(ar.result);break;default:}}},this)})},this));$(".naImgLink a, .na-edit").click(function(aj){aj.stopPropagation();aj.preventDefault();if(!y()){return}var ak=$(".layeruploadface");ak.find(".err_tip").hideError();ak.find("form").trigger("reset");$(ak.find(".mod_tip_bd").hide()[0]).show();ak.showPopup()});var L=100;$(".layeruploadface .uploaded .clipimg img").load(k.proxy(function(an){if(!this.uploadingPhoto){return}var al=$(an.target),ak=$(".layeruploadface .uploaded .movebox"),am=al.parent();$(".layeruploadface .uploading").hide();$(".layeruploadface .uploaded .err_tip").hideError();$(".layeruploadface .uploaded").show();$("#img_cache").append(al);var aj=al.width();imgHeight=al.height();var ap=Math.min(300,$(".layeruploadface .uploaded .clipimg").width());if(aj>imgHeight){if(aj>ap){imgHeight=Math.floor(imgHeight*ap/aj);aj=ap}}else{if(imgHeight>ap){aj=Math.floor(aj*ap/imgHeight);imgHeight=ap}}al.css({width:aj+"px",height:imgHeight+"px"}).appendTo(am);$("#img_cache").html("");L=Math.min(100,Math.min(al.width(),al.height()));al.css("top",Math.floor((ap-al.prop("offsetHeight"))/2));al.css("left",Math.floor((ap-al.prop("offsetWidth"))/2));var ao=Math.floor((ap-L)/2);ak[0].style.cssText="width:"+L+"px;height:"+L+"px;top:"+ao+"px;left:"+ao+"px;";this.uploadingPhoto=false},this));$(".layeruploadface .btn_mod_close").bind("click",function(aj){aj.preventDefault();aj.stopPropagation();$(".clipimg .uploadimgs img").removeAttr("style").attr("src","");$(aj.target).closest(".mod_acc_tip").hidePopup()});var E=$("#uploadPhoto"),aa=E[0];var J="";function D(ak){var aj=$("<DIV/>").html(ak);var al=aj.text();aj=null;return al}function ag(an){if(aa.readyState==="complete"||aa.readyState==="loaded"||(an&&an.type==="load")){J="";var am;try{am=aa.contentDocument||(aa.contentWindow&&aa.contentWindow.document)||aa.document;if(!am){return}}catch(ak){return}var ao=D($(am).find("textarea.jsonResult").val());var al=ao;al=al.replace("&&&START&&&","");al=$.parseJSONSafe(al);if(!al){$(".layeruploadface .uploading .sys_err").showError();return}if(al.result===0){J=D($(am).find("textarea.uploadResult").val());var aj=al.info.data.temp_url;$(".layeruploadface .uploaded .clipimg img").attr("src",aj)}else{if(al.result===1200521){if(al.info){al.result=al.info.issErrorCode}}switch(al.result){case 90021:$(".layeruploadface .uploading .file_too_large").showError(al.result);break;case 90018:$(".layeruploadface .uploading .wng_fmt").showError(al.result);break;case 5200522:case 5200524:case 5000000:$(".layeruploadface .uploading .sys_err").showError(al.result);break;case 1200523:$(".layeruploadface .uploading .missing_param").showError(al.result);break;case 80017:$(".layeruploadface .uploading .missing_file").showError(al.result);break;case 10007:$(".layeruploadface .uploading .unsupported_mime_type").showError(al.result);break;default:}}}}if("onreadystatechange" in aa){aa.onreadystatechange=ag}else{aa.onload=ag}var H=false;var W,V;var G=$(".movebox"),af=G[0];var T=$(".uploadimgs img");function Y(aj){if(aj.type.indexOf("touch")>-1){if(aj.originalEvent.touches&&aj.originalEvent.touches.length){return{pageX:aj.originalEvent.touches[0].pageX,pageY:aj.originalEvent.touches[0].pageY}}}else{return{pageX:aj.pageX,pageY:aj.pageY}}}G.bind("mousedown touchstart",function(ak){ak.preventDefault();ak.stopPropagation();H=true;var aj=Y(ak);W=aj.pageX-parseInt(G.css("left"));V=aj.pageY-parseInt(G.css("top"))});$(document).bind("mousemove touchmove",function(am){if(H){am.preventDefault();am.stopPropagation();if(JSP_VAR.deviceType==="mobile"&&am.target!==af){H=false;return}var al=parseInt(T.css("left"),10),ar=al+T.prop("offsetWidth")-G.prop("offsetWidth");var aq=parseInt(T.css("top"),10),aj=aq+T.prop("offsetHeight")-G.prop("offsetHeight");var at=Y(am);var ap=at.pageX-W;var ao=at.pageY-V;if(ap<al){ap=al}if(ao<aq){ao=aq}if(ap>ar){ap=ar}if(ao>aj){ao=aj}var an=Math.round((ap-al)*100/(T.prop("offsetWidth")-G.prop("offsetWidth")))+"%";var ak=Math.round((ao-aq)*100/(T.prop("offsetHeight")-G.prop("offsetHeight")))+"%";G.css({top:ao,left:ap})}}).bind("mouseup _touchend",function(aj){aj.preventDefault();H=false});var O=$(".layeruploadface .icon_square_rightbot"),U=O[0];var P,F,I=false;O.bind("mousedown touchstart",function(ak){ak.stopPropagation();ak.preventDefault();I=true;var aj=Y(ak);P=aj.pageX-parseInt(O.css("left"),10);F=aj.pageY-parseInt(O.css("top"),10)});$(document).bind("mousemove touchmove",function(am){if(I){am.stopPropagation();am.preventDefault();if(JSP_VAR.deviceType==="mobile"&&am.target!==U){I=false;return}var at=Y(am);var ao=at.pageX-P;var an=at.pageY-F;var al=parseInt(T.css("left"),10),ar=al+T.prop("offsetWidth")-parseInt(G.css("left"),10);var aq=parseInt(T.css("top"),10),aj=aq+T.prop("offsetHeight")-parseInt(G.css("top"),10);var ap=Math.max(ao,an);var ak=ap;if(ak<L){ak=L}if(ak>ar){ak=ar}if(ak>aj){ak=aj}ak-=2;G.css({height:ak,width:ak})}}).bind("mouseup _touchend",function(aj){if(I){I=false;aj.stopPropagation();aj.preventDefault()}});$(".layeruploadface .uploaded .btn_commom").click(function(aj){aj.preventDefault();if(!y()){return}$.ajax({url:"/pass/auth/profile/commitUpload",type:"POST",data:{userId:$(".na-num").text(),passport_ph:m.get("passport_ph")||"",usercenter_ph:m.get("usercenter_ph")||"",passportsecurity_ph:m.get("passportsecurity_ph")||"",passToken:m.get("passToken")||"",uploadResult:J,cropParam:(function(){var am=parseInt(T.css("left"),10),ao=T.prop("offsetWidth"),ar=G.prop("offsetWidth");var at=parseInt(T.css("top"),10),ap=T.prop("offsetHeight"),au=G.prop("offsetHeight");var al=parseInt(G.css("left"),10)-am,aq=parseInt(G.css("top"),10)-at,ak=al+ar,an=aq+au;al/=ao;aq/=ap;ak/=ao;an/=ap;if(al<0){al=0}if(al>1){al=1}if(aq<0){aq=0}if(aq>1){aq=1}if(ak<0){ak=0}if(ak>1){ak=1}if(an<0){an=0}if(an>1){an=1}return'{"x1":'+al+',"y1":'+aq+',"x2":'+ak+',"y2":'+an+"}"})},dataType:"text",error:v,success:function(ak){ak=ak.replace("&&&START&&&","");ak=$.parseJSONSafe(ak);if(ak.result===0){$(".layeruploadface").showPopup();location.reload(true)}else{$(".layeruploadface .uploaded .err_tip").hideError();switch(ak.result){case 5200517:case 5200518:case 5200519:case 5200520:case 5000000:$(".layeruploadface .uploaded .sys_err").showError(ak.result);break;case 1200514:case 1200516:$(".layeruploadface .uploaded .bad_param").showError(ak.result);break;case 1200515:$(".layeruploadface .uploaded .upload_failed").showError(ak.result);break;default:}}}})});$(".layereditinfo .nickname").keypress(function(aj){if(aj.keyCode===13){aj.preventDefault();$(".layereditinfo .btn_commom").click()}});this.syncHash();setInterval(k.proxy(function(){this.syncHash()},this),500)}});var f=k.$class({constructor:function(){},render:function(){this.uiBind()},uiBind:function(){},kick:function(){},onKick:function(){},requirePassword:function(){},untrust:function(){},onUntrust:function(){},findDevice:function(){},deleteRecord:function(){},editPassword:function(){}});var o=k.$class({constructor:function(){this.$bindingContainer=$("[_role=bindingContainer]");this.$a11nContainer=$("[_role=a11nContainer]")},render:function(){this.uiBind()},uiBind:function(){this.$bindingContainer.delegate("[_role=icon]","click",k.proxy(function(z){this.onClickBindingIcon($(z.target))},this));this.$a11nContainer.delegate("[_role=icon]","click",k.proxy(function(z){this.onClickA11NIcon($(z.target))},this))},onClickBindingIcon:function(A){var z=A.attr("_name");Util.showPopup(z)},onClickA11NIcon:function(A){var z=A.attr("_name");Util.showPopup(z)}});var a=k.$class({constructor:function(){},render:function(){this.uiBind()},uiBind:function(){}});var c=k.$class({constructor:function(){},showPopup:function(z){$(z).show()},hidePopup:function(z){$(z).hide()},fix:function(z){if($.browser.msie&&+$.browser.version<=6){z.css({position:"absolute"});var A=$(document);$win.bind("scroll resize",r.debounce(k.proxy(function(){z.css({top:A.scrollTop()+"px",left:A.scrollLeft()+"px"})},this),500))}}});var t=k.$class({constructor:function(z){z=z||{};this.sgp=z.sgp;this.phoneTip=new x(".phone_tip");this.phoneCaptTip=new x(".phone_capt_tip");this.smsTip=new x(".sms_tip");this.regTip=new x(".reg_tip");this.usageTip=new x(".usage_tip");this.photoTip=new x(".photo_tip");this.idTip=new x(".id_tip");this.passwordItemGroup=new h({max:3,parent:$("#passwords"),selector:".add_more",source:'<div class="add_more clearfix">'+$("#passwords .add_more").html()+"</div>",add:$("#passwords .add_more_link"),remove:$("#passwords .del_link")});this.emailItemGroup=new h({max:3,parent:$("#emails"),selector:".add_more",source:'<div class="add_more clearfix">'+$("#emails .add_more").html()+"</div>",add:$("#emails .add_more_link"),remove:$("#emails .del_link")});this.phoneItemGroup=new h({max:3,parent:$("#phones"),selector:".add_more",source:'<div class="add_more clearfix">'+$("#phones .add_more").html()+"</div>",add:$("#phones .add_more_link"),remove:$("#phones .del_link")});this.phoneModelItemGroup=new h({max:3,parent:$("#phone_models"),selector:".add_more",source:'<div class="add_more clearfix">'+$("#phone_models .add_more").html()+"</div>",add:$("#phone_models .add_more_link"),remove:$("#phone_models .del_link")});this.imeiItemGroup=new h({max:3,parent:$("#imeis"),selector:".add_more",source:'<div class="add_more clearfix">'+$("#imeis .add_more").html()+"</div>",add:$("#imeis .add_more_link"),remove:$("#imeis .del_link")});this.eshopInfoItemGroup=new h({max:3,parent:$("#eshop-info-inputs-group"),selector:".add_more",source:'<div class="add_more clearfix">'+$("#eshop-info-inputs-group .add_more").html()+"</div>",add:$("#eshop-info-inputs-group .add_more_link"),remove:$("#eshop-info-inputs-group .del_link")})},uiBind:function(){$(".listtit").click(function(M){M.stopPropagation();$(".country-container").toggle()});$(document.body).click(function(M){$(".country-container").hide();B=false});$(".country-container").delegate(".record","click",function(R){R.stopPropagation();$(".country-container").hide();var S=$(R.target).closest(".record");var O=S.find(".record-country");var M=S.find(".record-code");var Q=$.trim(M.text()),N=$.trim(O.text()),P=O.data("code");$(".listtit").attr("_code",P).find("tt").text(N+"("+Q+")")});$(".chkcode_img").click(function(N){N.stopPropagation();var M=N.target,O=M.getAttribute("_src");M.src=O+"&"+(+new Date);B=true});$("#phone").bind("focus click",k.proxy(function(M){this.phoneTip.hide();$("#appeal .shenhe_by_phone .phone_tip:not(.too_much)").hide();$(M.target).parent().removeClass("err_label")},this)).blur(k.proxy(function(N){this.phoneTip.hide();var M=$.trim(N.target.value);if(!M){this.phoneTip.show("empty_phone");$("#phone").parent().addClass("err_label")}else{if(!/^\d+$/.test(M)){this.phoneTip.show("wng_fmt");$("#phone").parent().addClass("err_label")}}},this));var B=false;$("#phone_capt").bind("focus click",k.proxy(function(M){this.phoneCaptTip.hide();$(M.target).parent().removeClass("err_label")},this)).blur(k.proxy(function(M){setTimeout(k.proxy(function(){if(B){return}this.phoneCaptTip.hide();var N=$.trim(M.target.value);if(!N){this.phoneCaptTip.show("empty_capt");$(M.target).parent().addClass("err_label")}},this),150)},this));$(".chkcode_img").click(function(M){$("#phone_capt").val("")});$("#resend").click(k.proxy(function(M){if($(M.target).hasClass("noSend")){return}sendResetTicket(true)},this));$(".resendcode").bind("focus click",k.proxy(function(M){this.smsTip.hide()},this)).blur(k.proxy(function(N){var M=$.trim($(".resendcode").val());if(!M){this.smsTip.show("empty_capt");$(".resendcode").parent().addClass("err_label")}},this));$("#validate").click(k.proxy(function(N){var M=$.trim($(".resendcode").val());if(!M){this.smsTip.show("empty_capt");$(".resendcode").parent().addClass("err_label");return}$.ajax({url:"/pass/retrieve/verifyPhoneContactAddress",type:"POST",dataType:"text",data:{externalId:$("#externalId").val(),vkey:M,contactAddress:($(".listtit").attr("_code")||"")+$("#phone").val()},error:v,success:k.proxy(function(O){O=$.parseJSONSafe(O.replace("&&&START&&&",""));if(O.code===0){this.nextTabPanel();this.nextTabHeader()}else{switch(O.code){case 70008:this.smsTip.show("wng_fmt");break;case 20003:this.smsTip.show("not_exists");break;case 70014:this.smsTip.show("wng_capt");$(".resendcode").val("").parent().addClass("err_label");break;case 10001:case 5000000:this.smsTip.show("sys_err");$(".resendcode").val("").parent().addClass("err_label");break;default:}}},this)})},this));var D=60000,C=60000;$("#back_to_sms").click(k.proxy(function(M){M.preventDefault();if(this.smsTimer){this.smsTimer.stop()}var N=$("#resend").attr("_text");if(N){$("#resend").text(N)}setTimeout(k.proxy(function(){this.phoneCaptTip.hide();$("#phone_capt").parent().removeClass("err_label");this.prevTabPanel()},this),100)},this));var I={};$("#submitPhone").click(k.proxy(function(R){R.preventDefault();this.phoneTip.hide();var S=$.trim($("#phone").val());if(!S){this.phoneTip.show("empty_phone");$("#phone").parent().addClass("err_label");return}else{if(!/^\d+$/.test(S)){this.phoneTip.show("wng_fmt");$("#phone").parent().addClass("err_label");return}}this.phoneCaptTip.hide();this.smsTip.hide();$(".resendcode").parent().removeClass("err_label");var N=$.trim($("#phone_capt").val());if(!N){this.phoneCaptTip.show("empty_capt");$("#phone_capt").parent().addClass("err_label");return}var P=$(".listtit").attr("_code")||"",U=$("#phone").val(),O=P+U;var T;if(!P){T="+86 "+U}else{T=P+" "+U}var Q=window.sendResetTicket=k.proxy(function(W){var V={externalId:$("#externalId").val(),icode:$("#phone_capt").val(),contactAddress:O};if(!$(".shenhe_by_phone .inputcode:visible").length){delete V.icode}$.ajax({type:"POST",dataType:"text",url:"/pass/retrieve/phoneContactAddressConfirmMessage",data:V,error:v,success:k.proxy(function(X){X=$.parseJSONSafe(X.replace("&&&START&&&",""));this.phoneCaptTip.hide();this.phoneTip.hide();$("#phone").parent().removeClass("err_label");$("#phone_capt").parent().removeClass("err_label");switch(X.code){case 0:$(".shenhe_by_phone .inputcode").hide();$("#full_phone").val(O);$(".regbox .step2 em").text(T);var aa=$(".regbox .step2 #resend"),Z=aa.attr("_text");aa.addClass("noSend");var Y=this.smsTimer=new r.Countdown({duration:C,onProgress:function(ab){aa.text(Z+"("+Math.round(ab.timeLeft/1000)+")")},onComplete:function(){aa.text(Z);if(I[O]>0){aa.removeClass("noSend")}}});C+=D;Y.start();$(".resendcode").val();I[O]--;if(!W){this.nextTabPanel()}break;case 70021:this.phoneTip.show("mibao");$("#phone").val("").parent().addClass("err_label");$(".chkcode_img").click();break;case 70013:this.phoneTip.show("bound");$("#phone").val("").parent().addClass("err_label");$(".chkcode_img").click();break;case 20003:this.phoneTip.show("not_exists");$("#phone").val("").parent().addClass("err_label");$(".chkcode_img").click();break;case 20031:$(".shenhe_by_phone .inputcode").show();this.phoneTip.show("empty_capt");$("#phone_capt").parent().addClass("err_label");$(".chkcode_img").click();if(W){this.prevTabPanel()}break;case 20023:this.phoneTip.show("too_many");$("#phone").val("").parent().addClass("err_label");$(".chkcode_img").click();break;case 87001:$(".shenhe_by_phone .inputcode").show();this.phoneCaptTip.show("wng_capt");$("#phone_capt").parent().addClass("err_label");$(".chkcode_img").click();if(W){this.prevTabPanel()}break;case 70008:this.phoneTip.show("wng_fmt");$("#phone").val("").parent().addClass("err_label");$(".chkcode_img").click();break;case 70022:this.phoneTip.show("send_fail");$("#phone").parent().addClass("err_label");$(".chkcode_img").click();break;case 10001:case 5000000:this.phoneTip.show("sys_err");$(".chkcode_img").click();break;default:this.phoneTip.show("sys_err");$(".chkcode_img").click()}},this)})},this);var M=0;if(I.hasOwnProperty(O)){M=I[O];if(M>0){Q()}else{$("#quotaLabel").text(0).parent().show()}}else{$.ajax({data:{address:O,contentType:4000004,userId:-1},type:"POST",url:"/pass/sms/quota",dataType:"text",success:function(W){W=$.parseJSONSafe(W.replace("&&&START&&&",""));if(W.result===0){var V=I[O]=W.info;Q()}else{switch(W.result){default:var V=I[O]=5;Q()}}},error:function(){Q()}})}},this));var K=$("#submitPhone"),G=$("#phone"),z=$("#prefix"),A=$("#appeal .shenhe_by_phone .too_much"),L=$("#quotaLabel"),E="0";setInterval(function(){var O=z.attr("_code")||"",M=G.val(),N=O+M;if(I.hasOwnProperty(N)){if(I[N]>0){A.hide();K.removeClass("disabled")}else{A.show();K.addClass("disabled")}if(I[N]<=2){L.text(Math.max(0,I[N])).parent().show()}else{L.text(0).parent().hide()}}else{A.hide();K.removeClass("disabled");L.text(0).parent().hide()}},1000);$("#serviceUsed-dom .checkbox_container").click(function(M){$(M.target).closest(".checkbox_container").toggleClass("now")});function H(){if($("#devices .othway").hasClass("now")||!$('#devices .input_kuang[name!=""][value=]:not(":disabled")').length){$("#var_btn").removeClass("disabled")}else{$("#var_btn").addClass("disabled")}}$("#devices .othway").click(function(M){$(M.currentTarget).toggleClass("now");H()});$("#phone_models, #imeis").bind("keypress click",H);setInterval(H,1000);$("#YearLocation-dom .del_link").click(function(P){var N=$("#YearLocation-dom");var O=N.find(".areapick_container .areapicker");var M=O.length;if(M>1){$(O[M-1]).remove()}M--;if(M<2){$(P.target).hide()}$("#YearLocation-dom .add_more_link").show()});$("#YearLocation-dom .add_more_link").click(function(R){var N=$("#YearLocation-dom");var Q=N.find(".areapick_container");var P=$('<div class="areapicker c_b"/>').html(Q.find(".areapicker-tmpl").html()).appendTo(Q);selectArea(P);$("#YearLocation-dom .del_link").show();var O=N.find(".areapick_container .areapicker");var M=O.length;if(M>=3){$(R.target).hide()}$("#YearLocation-dom .i_selectoption > dd:first-child").hide()});$("#reg_by").change(k.proxy(function(N){var M=+N.target.value;switch(M){case -1:case 1:$("#reg_via").parent().show();$("#reg_via2").parent().hide();$("#reg_via3").parent().hide();break;case 2:$("#reg_via2").parent().show();$("#reg_via3").parent().hide();$("#reg_via").parent().hide();break;case 0:$("#reg_via3").parent().show();$("#reg_via").parent().hide();$("#reg_via2").parent().hide();break;default:}$("#registerWay-dom .reg_by").hide();if(M!==-1){this.regTip.hide("reg_by")}},this));$("#reg_via, #reg_via2, #reg_via3").change(k.proxy(function(N){$("#registerWay-dom .reg_via").hide();var M=+N.target.value;if(M!==-1){this.regTip.hide("reg_via")}},this));$("#submit_reg").click(k.proxy(function(P){this.regTip.hide();var M=+$("#reg_by").val();if(M===-1){this.regTip.show("reg_by");return}var O;if(M===1){O=+$("#reg_via").val()}else{if(M===2){O=+$("#reg_via2").val()}else{O=+$("#reg_via3").val()}}if(O===-1){this.regTip.show("reg_via");return}var Q=false;$(".areapicker").each(function(U,ab){var Z=$(ab);var V=Z.find(".year"),X=Z.find(".country"),aa=Z.find(".province"),S=Z.find(".city");var R=V.prop("selectedIndex"),W=X.prop("selectedIndex"),Y=aa.prop("selectedIndex"),T=S.prop("selectedIndex");if(R&&W){Q=true;return false}});if(!Q){this.regTip.show("area");return}var N=!!($(".checkbox_container.now").length||$(".checkbox_more label input").val());if(!N){this.regTip.show("service");return}this.nextTabHeader();this.nextTabPanel()},this));$("#back_to_reg").click(k.proxy(function(M){M.preventDefault();if(!$("#devices .othway").hasClass("now")){this.prevTabPanel();this.prevTabHeader()}else{this.nextTabPanel();this.nextTabHeader()}},this));$("#back_to_devices").click(k.proxy(function(M){M.preventDefault();this.prevTabPanel();this.prevTabHeader()},this));$("#back_to_usage").click(k.proxy(function(M){M.preventDefault();this.prevTabPanel();this.prevTabHeader()},this));$("#var_btn").click(k.proxy(function(N){var O=$(N.currentTarget);if(O.hasClass("disabled")){return}if($("#devices .othway").hasClass("now")){this.nextTabPanel();$("#imeis .input_kuang").each(function(P,Q){if(!/^\d*$/.test(Q.value)){Q.value=""}});return}this.usageTip.hide();$("#phone_models .labelbox, #imeis .labelbox").removeClass("err_label");var M=false;$("#imeis .input_kuang").each(function(P,Q){var R=$.trim(Q.value);if(R&&!/^\d+$/.test(R)){M=true;$(Q).parent().addClass("err_label");return false}});if(M){this.usageTip.show("wng_imei_fmt");return}this.nextTabPanel()},this));$("#usage_btn").click(k.proxy(function(P){this.usageTip.hide();this.regTip.hide();var R=true,O=true,Q=true;$(".areapicker").each(function(V,ac){var aa=$(ac);var W=aa.find(".year"),Y=aa.find(".country"),ab=aa.find(".province"),T=aa.find(".city");var S=W.prop("selectedIndex"),X=Y.prop("selectedIndex"),Z=ab.prop("selectedIndex"),U=T.prop("selectedIndex");if(!S){O=false}if(!X){Q=false}if(!(S&&X)){R=false;return false}});if(!O){this.regTip.show("year");return false}if(!Q){this.regTip.show("locale");return false}if(!R){this.regTip.show("area");return}var N=this;$("#passwords .labelbox, #emails .labelbox, #phones .labelbox").removeClass("err_label").delegate(".input_kuang","focus",function(){N.usageTip.hide()});var M=false;if(!$("#passwords .un_provide_area").hasClass("now")){$("#passwords .input_kuang").each(function(S,T){var U=$.trim(T.value);if(!U){M=true;$(T).parent().addClass("err_label");N.usageTip.show("empty-pwd-value")}});if(M){return}}if(!$("#emails .un_provide_area").hasClass("now")){$("#emails .input_kuang").each(function(S,T){var U=$.trim(T.value);if(!U){M=true;$(T).parent().addClass("err_label");N.usageTip.show("empty-email-value")}else{if(U&&!/^[\w.\-]+@(?:[a-z0-9]+(?:-[a-z0-9]+)*\.)+[a-z]{2,6}$/.test(U)){M=true;$(T).parent().addClass("err_label");N.usageTip.show("wng_email_fmt")}}});if(M){return}}if(!$("#phones .un_provide_area").hasClass("now")){$("#phones .input_kuang").each(function(S,T){var U=$.trim(T.value);if(!U){M=true;$(T).parent().addClass("err_label");N.usageTip.show("empty-phone-value")}else{if(U&&!/^\+?\d+$/.test(U)){M=true;$(T).parent().addClass("err_label");N.usageTip.show("wng_phone_fmt");return false}}});if(M){return}}$(this).trigger("panelSubmit")},this));$("#id_type").change(k.proxy(function(N){var M=+N.target.value;if(M){this.idTip.hide("empty_id_type")}},this));$("#final_btn").click(k.proxy(function(M){this.idTip.hide();if(!+$("#id_type").val()){this.idTip.show("empty_id_type");return}if(!$("#name_value").val()){this.idTip.show("empty_name_value");return}if(!$("#id_value").val()){this.idTip.show("empty_id_value");return}if(window.JSP_VAR&&window.JSP_VAR.deviceType!=="PC"){}else{if(!$("#photoId").val()){this.idTip.show("empty_id_photo");return}}this.submit()},this));$("#emails").delegate(".err_label","click focus",k.proxy(function(M){$(".wng_email_fmt").hide()},this));$("#phones").delegate(".err_label","click focus",k.proxy(function(M){$(".wng_phone_fmt").hide()},this));$("#imeis").delegate(".err_label","click focus",k.proxy(function(M){$(".wng_imei_fmt").hide()},this));$(document.body).delegate(".err_label","click focus",function(M){$(M.target).closest(".err_label").removeClass("err_label")});var F=this;window.uploadSuccess=function(){var P=window.frames&&window.frames.uploadIframe;if(!P||!P.data){return}var O=P.data;var N=O.tempId;var Q=O.data;if(N!=$("#imgId").val()){return}clearTimeout(F.uploadTimeout);$("#timeout_mes").hide();$("#loading").hide();$("#photoId").val(Q.mfsFileId);if(!Q.success){switch(Q.errorCode){case 20003:F.photoTip.show("not_exists");break;case 20005:F.photoTip.show("wng_fmt");break;case 10012:case 10001:F.photoTip.show("sys_err");break;case 80004:F.photoTip.show("file_too_large");break;default:F.photoTip.show("error")}}else{F.photoTip.hide();$("#img_area").attr("src","/pass/retrieve/photo/download?externalId="+encodeURIComponent($("#externalId").val())+"&mfsFileId="+Q.mfsFileId+"&photoKey="+Q.authkey);var M=$("#fileUpload");var R=M.attr("_retext");$("#fileButton").text(R);M.val(R)}};$("#img_area").bind("load error",function(M){$("#img_area").show()});$("#fileUpload").change(k.proxy(function(T){var N=T.target,Q=N.form,R=N.value;if(R){var S=R.lastIndexOf(".");if(S!==-1){var O=R.substring(S+1).toLowerCase();if(O!=="png"&&O!=="jpg"){F.photoTip.show("wng_fmt");$("#img_area").hide();return}}var P=N.files;if(P&&P.length){var M=P[0];if(M.size>5<<20){F.photoTip.show("file_too_large");$("#img_area").hide();return}}$("#imgId").val(+new Date);$(Q).trigger("submit");$("#loading").show();$("#img_area").hide();$("#timeout_mes").hide();$("#error_mes").hide();this.uploadTimeout=setTimeout(k.proxy(function(){$("#loading").hide();$("#imgId").val(+new Date);$("#timeout_mes").show()},this),60000)}},this));$("#phone, #phone_capt").bind("keypress",function(M){if(M.keyCode===13){$("#submitPhone").click()}});$(".resendcode").bind("keypress",function(M){if(M.keyCode===13){$("#validate").click()}});$('input[name="moreServices"]').bind("keypress",function(M){if(M.keyCode===13){$("#submit_reg").click()}});$(document.body).delegate('input[name="passwordUsed"], input[name="bindEmailUsed"], input[name="bindPhoneUsed"], input[name="mobilePhoneModel"], input[name="androidPhoneIMEI"], input[name="iphoneWIFI"]',"keypress",function(M){if(M.keyCode===13){$("#var_btn").click()}});$("#id_value").bind("keypress",function(M){if(M.keyCode===13){$("#final_btn").click()}});$("#reg_by + .i_selectbox .i_currentselected").click(function(){$(".regVia .i_selectoption, #YearLocation-dom .i_selectoption").hide()});$(".regVia .i_currentselected").click(function(){$("#reg_by + .i_selectbox .i_selectoption, #YearLocation-dom .i_selectoption").hide()});$("#YearLocation-dom").delegate(".i_currentselected","click",function(M){$("#registerType-dom .i_selectoption, #registerWay-dom .i_selectoption").hide()});var J=document.getElementById("imeis");setInterval(function(){var N=J.getElementsByTagName("input");for(var P=0,M=N.length;P<M;P++){var O=N[P];O.value=O.value.replace(/\D/g,"")}N=null},500)},isPhoneNumber:function(z){if(/^\d{6,}$/.test(z)||/^\+\d{6,}$/.test(z)||/^0{2}\d{6,}$/.test(z)){return true}return false},initStep2:function(){var A=$("#retrieve-type .submit-to-next");var C=$("#retrieve-type .retrieve-type");var z=$("#retrieve-type .retrieve-type-value");var B=this.radioTab=$("#retrieve-type .md_way>li").bind("radioTabValueChange",function(F,E){if(E!==false){A.removeClass("disabled");C.val(E.retrieveType);z.val(E.retrieveTypeValue)}else{A.addClass("disabled");C.val("");z.val("")}}).radioTab();var D=this;A.click(function(){if(!A.hasClass("disabled")){D.nextTabPanel();D.nextTabHeader()}})},initStep3:function(){var A=$("#eshop-info");var z=A.find(".submit-to-next").addClass("disabled");A.find(".othway").bind("click",function(){var C=$(this);C.toggleClass("now");if(C.hasClass("now")){$("#eshop-info-inputs-group").data("disable-add","1");A.find(".labelbox").addClass("input_disabled").find("input").attr("disabled","true");z.removeClass("disabled")}else{$("#eshop-info-inputs-group").data("disable-add","0");A.find(".labelbox").removeClass("input_disabled").find("input").removeAttr("disabled");z.addClass("disabled")}});var B=this;A.delegate("input","input change propertychange",function(){var C=true;A.find("input[name=eshopPhoneNumber]").each(function(D,E){if(!B.isPhoneNumber($(E).val())){C=false}});if(C){z.removeClass("disabled")}else{z.addClass("disabled")}}).delegate(".icon_add_del","click",function(){A.find("input[name=eshopPhoneNumber]").trigger("change")}).find("input[name=eshopPhoneNumber]").trigger("change");z.bind("click",k.proxy(function(){if(!z.hasClass("disabled")){this.nextTabPanel();this.nextTabHeader()}},this))},initStep4:function(){},initAll:function(){$(this).bind("panelSubmit",k.proxy(function(B,A){this.nextTabPanel();if(A){this.nextTabHeader()}},this));var z=this;$(".un_provide_area").bind("click",function(){var B=$(this);B.toggleClass("now");var A=B.parents(".comfill_con");if(B.hasClass("now")){A.find(".labelbox").addClass("input_disabled").removeClass("err_label").find("input[name!='']").attr("disabled","disabled").val("");A.data("disable-add","1");z.usageTip.hide()}else{A.find(".labelbox").removeClass("input_disabled").find("input[name!='']").removeAttr("disabled");A.data("disable-add","0")}});$(".panel-btn-back").bind("click",function(){z.prevTabPanel();if($(this).data("first-panel")){z.prevTabHeader()}})},render:function(){this.uiBind();this.initAll();this.initStep2();this.initStep3();this.initStep4();this.toFirstHeader();this.toFirstPanel();var A=$("#resend");A.attr("_text",A.text());this.decoSelect("select[_decorable]");this.decoYearSelect("select.year");$("#YearLocation-dom .areapicker").each(function(C,D){var B=$(D);selectArea(B)});$(".chkcode_img").click();this.passwordItemGroup.render();this.emailItemGroup.render();this.phoneItemGroup.render();this.phoneModelItemGroup.render();this.imeiItemGroup.render();this.eshopInfoItemGroup.render();if(this.sgp){$(".othway").hide()}var z=$("#usage");$("#appeal").append(z);$("#uploadImgForm").appendTo("#nested").show();$("#YearLocation-dom .i_selectoption > dd:first-child").hide()},toFirstHeader:function(){var A=$(".tab_opt > span");var z=0;$(A.removeClass("now")[z]).addClass("now");var B=$(".tabline > i");$(B.removeClass("now")[z]).addClass("now");window.scrollTo(0,0)},toFirstPanel:function(){var A=$("#appeal .bd");var z=0;$(A.hide()[z]).show();window.scrollTo(0,0)},nextnextTabHeader:function(){var A=$(".tab_opt > span");var z=A.filter(".now").index("span");$(A.removeClass("now")[z+2]).addClass("now");var B=$(".tabline > i");$(B.removeClass("now")[z+2]).addClass("now");window.scrollTo(0,0)},nextTabHeader:function(){var A=$(".tab_opt > span");var z=A.filter(".now").index("span");$(A.removeClass("now")[z+1]).addClass("now");var B=$(".tabline > i");$(B.removeClass("now")[z+1]).addClass("now");window.scrollTo(0,0)},prevprevTabHeader:function(){var A=$(".tab_opt > span");var z=A.filter(".now").index("span");$(A.removeClass("now")[z-2]).addClass("now");var B=$(".tabline > i");$(B.removeClass("now")[z-2]).addClass("now");window.scrollTo(0,0)},prevTabHeader:function(){var A=$(".tab_opt > span");var z=A.filter(".now").index("span");$(A.removeClass("now")[z-1]).addClass("now");var B=$(".tabline > i");$(B.removeClass("now")[z-1]).addClass("now");window.scrollTo(0,0)},nextnextTabPanel:function(){var A=$("#appeal .bd");var z=A.filter(":visible").index(".bd");$(A.hide()[z+2]).show();window.scrollTo(0,0)},nextTabPanel:function(){var A=$("#appeal .bd");var z=A.filter(":visible").index(".bd");$(A.hide()[z+1]).show();window.scrollTo(0,0)},prevTabPanel:function(){var A=$("#appeal .bd");var z=A.filter(":visible").index(".bd");$(A.hide()[z-1]).show();window.scrollTo(0,0)},prevprevTabPanel:function(){var A=$("#appeal .bd");var z=A.filter(":visible").index(".bd");$(A.hide()[z-2]).show();window.scrollTo(0,0)},decoSelect:function(z){var A=$(z);A.iSimulateSelect();$(".i_currentselected, i_selectoption, .i_selectoption").css("width","100%");$(".i_selectoption > dd:first-child").hide()},appendSelect:function(z,A){$(A).append(decoSelect(z))},prependSelect:function(z,A){$(A).prepend(decoSelect(z))},decoYearSelect:function(z){$(z).each(function(B,D){var A=D.options;A.length=1;var C=new Date().getFullYear();for(var F=C;F>=2012;F--){var E=$('<option value="'+F+'">'+F+"</option>").appendTo(D)}})},submit:function(){var D="";switch(+$("#reg_by").val()){case -1:case 1:D=$("#reg_via").val();break;case 2:D=$("#reg_via2").val();break;case 0:D=$("#reg_via3").val();break;default:}$("#reg_way").val(D);$('#devices [name="androidPhoneIMEI"], #devices [name="iphoneWIFI"]').each(function(E,F){var G=$.trim(F.value);if(!G){$(F).remove()}});var B=$("#services .checkbox_container.now");var z=$("#services .serviceUsed");B.each(function(E,F){var G=$(F).find(".icon_select").attr("value");z.filter('[value="'+G+'"]').prop("checked",true)});var C=$("#locations .areapicker"),A=$("#locations .frequentlyLoginLocation");C.each(function(G,N){var L=$(N);var H=L.find(".year"),I=L.find(".country"),M=L.find(".province"),F=L.find(".city");var J=H.val(),E=I.val();if(J&&E){var K=[H.val(),I.val(),M.val(),F.val()].join("-");$(A[G]).val(K)}});$("#appeal").trigger("submit")}});var h=k.$class({constructor:function(z){this.$parent=$(z.parent||z.$parent);this.selector=z.selector;this.source=z.source;this.$add=$(z.add||z.$add);this.$remove=$(z.remove||z.$remove);this.min="min" in z?z.min:1;this.max="max" in z?z.max:Number.MAX_VALUE},items:function(){return this.$parent.children(this.selector)},size:function(){return this.items().length},uiBind:function(){this.$add.click(k.proxy(function(z){z.preventDefault();this.add()},this));this.$remove.click(k.proxy(function(z){z.preventDefault();this.remove()},this))},add:function(){var z=this.items(),A=z.length;var D=this.$parent.find(".un_provide_area");if(this.$parent.data("disable-add")==="1"){return}if(A<this.max){var C=$(this.source);var B=$(z[A-1]);if(B.length){B.after(C)}else{this.$parent.append(C)}}this.$remove.show();D.hide();if(A+1>=this.max){this.$add.hide()}},remove:function(){var z=this.items(),A=z.length;var B=this.$parent.find(".un_provide_area");if(A>this.min){$(z[A-1]).remove()}this.$add.show();if(A-1<=this.min){this.$remove.hide();B.show()}},render:function(){this.uiBind();var z=this.size();if(z<=this.min){this.$remove.hide()}else{this.$remove.show()}if(z>=this.max){this.$add.hide()}else{this.$add.show()}}});var n=k.$class({constructor:function(z){z=z||{};this.$idBox=$("#externalId");this.$form=this.$idBox.closest("FORM");this.idTip=new x(".id_tip")},render:function(){this.uiBind()},uiBind:function(){this.$idBox.bind("click focus",k.proxy(function(z){this.idTip.hide();this.$idBox.parent().removeClass("err_label")},this));this.$form.submit(k.proxy(function(A){var B=$.trim(this.$idBox.val());if(!B){this.idTip.show("empty_id");this.$idBox.parent().addClass("err_label");return false}var z=new RegExp(this.$idBox.attr("rule"));if(!z.test(B)){this.idTip.show("wng_fmt");this.$idBox.parent().addClass("err_label");return false}B=B.replace(/^\+86/,"");this.$idBox.val(B)},this))}});return{Security:g,Profile:u,LoginManager:f,BindingA11N:o,Services:a,Utils:c,AppealForm:t,PreappealForm:n}});